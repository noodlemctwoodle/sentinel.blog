{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Workspace}"
        ],
        "parameters": [
          {
            "id": "26d2fea7-3646-4993-b79f-6722f9ef8ddb",
            "version": "KqlParameterItem/1.0",
            "name": "DefaultSubscription_Internal",
            "type": 1,
            "isRequired": true,
            "query": "where type =~ 'microsoft.operationalinsights/workspaces'\n| take 1\n| project subscriptionId",
            "crossComponentResources": [
              "value::selected"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "55d3ab63-6e1f-4d02-8d9e-2225526689c7",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "label": "Subscriptions",
            "type": 6,
            "description": "Select one or more subscriptions (for cross-subscription migrations)",
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "summarize by subscriptionId\n| project value = strcat(\"/subscriptions/\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)",
            "crossComponentResources": [
              "value::all"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "selectAllValue": "*",
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "/subscriptions/5305ccd2-977a-4630-843b-bad582e756a3"
            ]
          },
          {
            "id": "source-workspace-param",
            "version": "KqlParameterItem/1.0",
            "name": "SourceWorkspace",
            "label": "Source Sentinel Workspace",
            "type": 5,
            "description": "Select the source workspace you're migrating FROM",
            "isRequired": true,
            "query": "where type =~ \"microsoft.operationalinsights/workspaces\"",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::1"
              ],
              "showDefault": false
            },
            "defaultValue": "value::1",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "95a45501-31b5-4ea2-bcb3-eb208e0080e2",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "label": "Target Sentinel Workspace",
            "type": 5,
            "description": "Select the target workspace you're migrating TO",
            "isRequired": true,
            "query": "where type =~ \"microsoft.operationalinsights/workspaces\"\r\n| where id != '{SourceWorkspace}'",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "additionalResourceOptions": [
                "value::1"
              ],
              "showDefault": false
            },
            "defaultValue": "value::1",
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "7d597ad7-4a2a-45ed-a4fe-7ee32de0fc22",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time Range",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 2592000000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 7776000000
                }
              ]
            }
          },
          {
            "id": "6b2826e2-d445-4475-a825-f512c6111719",
            "version": "KqlParameterItem/1.0",
            "name": "MigrationTips",
            "type": 10,
            "isRequired": true,
            "jsonData": "[\r\n    {\"value\": \"Yes\", \"label\": \"Yes\"},\r\n    {\"value\": \"No\", \"label\": \"No\", \"selected\":true}\r\n]",
            "value": "Yes"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "Instructions",
            "type": 10,
            "isRequired": true,
            "typeSettings": {
              "showDefault": false
            },
            "jsonData": "[\r\n    {\"value\": \"Yes\", \"label\": \"Yes\"},\r\n    {\"value\": \"No\", \"label\": \"No\", \"selected\":true}\r\n]",
            "id": "90160c73-64bb-44ef-983e-b4996ed33d83",
            "value": "Yes"
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "WSSelector"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "overview-tab",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Migration Overview",
            "subTarget": "Overview",
            "style": "link"
          },
          {
            "id": "readiness-tab",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Readiness Assessment",
            "subTarget": "Readiness",
            "style": "link"
          },
          {
            "id": "5fc3d46c-8f59-48c2-98d4-7f22191749ab",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Data Connectors",
            "subTarget": "DC",
            "style": "link"
          },
          {
            "id": "dcr-tab",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Data Collection Rules",
            "subTarget": "DCR",
            "style": "link"
          },
          {
            "id": "0dca8dda-ce11-4da1-89e4-f60abb1599f5",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Analytics",
            "subTarget": "AR",
            "style": "link"
          },
          {
            "id": "watchlist-tab",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Watchlists",
            "subTarget": "WL",
            "style": "link"
          },
          {
            "id": "df01148a-5f43-4fed-8b5e-a5302fd86f63",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Workbooks",
            "subTarget": "Wb",
            "style": "link"
          },
          {
            "id": "0846bc85-d2da-4bd8-bcc1-063c115e5f11",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Automation",
            "subTarget": "LA",
            "style": "link"
          },
          {
            "id": "1c9b4395-2951-4795-be2d-1fd1a5f17143",
            "cellValue": "Tab",
            "linkTarget": "parameter",
            "linkLabel": "Data Migration",
            "subTarget": "DM",
            "style": "link"
          }
        ]
      },
      "name": "links - 2"
    },
    {
      "type": 1,
      "content": {
        "json": "## Microsoft Sentinel Migration Tracker\r\n\r\nThis workbook helps you track and manage migrations between Microsoft Sentinel workspaces.\r\n\r\n**Multi-Subscription Support:**\r\n- You can now select multiple subscriptions to support cross-subscription migrations\r\n- Useful for region migrations, tenant migrations, or workspace consolidations across different subscriptions\r\n- Select both source and target subscriptions in the **Subscriptions** dropdown above\r\n\r\n**Migration Scenarios Supported:**\r\n- **Workspace Consolidation**: Merging multiple workspaces into one\r\n- **Region Migration**: Moving to a different Azure region\r\n- **Tenant Migration**: Moving to a different Azure tenant\r\n- **Subscription Move**: Transferring workspace to a different subscription",
        "style": "info"
      },
      "name": "migration-info-header",
      "conditionalVisibility": {
        "parameterName": "Instructions",
        "comparison": "isEqualTo",
        "value": "Yes"
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "view-selector",
                  "version": "KqlParameterItem/1.0",
                  "name": "View",
                  "type": 10,
                  "isRequired": true,
                  "jsonData": "[\r\n    {\"value\": \"Compare\", \"label\": \"Source vs Target Comparison\"},\r\n    {\"value\": \"Monitor\", \"label\": \"Monitor Target\", \"selected\":true},\r\n    {\"value\": \"Configure\", \"label\": \"Configure Target\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "Monitor"
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "dc-view-selector"
          },
          {
            "type": 1,
            "content": {
              "json": "### Sentinel to Sentinel Data Connector Migration\r\n\r\n**Migration Strategy:**\r\n\r\n1. **Identify Source Connectors** - Review all active data sources in source workspace\r\n2. **Plan Dual Ingestion** - Determine which connectors can send to both workspaces simultaneously\r\n3. **Configure Target** - Set up equivalent connectors in target workspace\r\n4. **Validate Data Flow** - Confirm data is flowing correctly to target\r\n5. **Monitor Parallel Operation** - Track data volumes in both workspaces\r\n6. **Cutover** - Redirect single-destination connectors to target\r\n\r\n### Key Considerations for Sentinel-to-Sentinel:\r\n\r\n**Multi-workspace Connectors (Easy Migration):**\r\n- Microsoft 365 Defender (can send to multiple workspaces)\r\n- Office 365 (supports multiple workspaces)\r\n- Azure Activity (one per subscription, can be sent to multiple workspaces)\r\n- Microsoft Entra ID (can be configured for multiple workspaces)\r\n- Defender for Cloud (can send alerts to multiple workspaces)\r\n\r\n**Single-destination Connectors (Require Planning):**\r\n- CEF/Syslog forwarders (can only forward to one workspace)\r\n- Custom API connectors (may have rate limits)\r\n- Agent-based collection (AMA/MMA points to one workspace)\r\n\r\n**Best Practice:** Enable multi-workspace connectors in both environments during migration, then carefully plan cutover for single-destination connectors.\r\n",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "MigrationTips",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "sentinel-migration-guidance"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Source vs Target Workspace Comparison",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "## Data Connector Comparison\r\n\r\nComparing data ingestion between:\r\n- **Source:** {SourceWorkspace:name}\r\n- **Target:** {Workspace:name}\r\n"
                  },
                  "name": "comparison-header"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SourceData = workspace('{SourceWorkspace}').Usage\r\n| summarize SourceGB = sum(Quantity) by DataType;\r\nlet TargetData = workspace('{Workspace}').Usage\r\n| summarize TargetGB = sum(Quantity) by DataType;\r\nSourceData\r\n| join kind=fullouter (TargetData) on DataType\r\n| extend DataType = coalesce(DataType, DataType1)\r\n| extend SourceGB = coalesce(SourceGB, 0.0)\r\n| extend TargetGB = coalesce(TargetGB, 0.0)\r\n| extend Variance = round(TargetGB - SourceGB, 2)\r\n| extend VariancePercent = iff(SourceGB > 0, round((TargetGB - SourceGB) / SourceGB * 100, 1), 0.0)\r\n| extend Status = case(\r\n    SourceGB > 0 and TargetGB == 0, 'üî¥ Missing in Target',\r\n    SourceGB == 0 and TargetGB > 0, 'üü° New in Target',\r\n    TargetGB >= SourceGB * 0.8 and TargetGB <= SourceGB * 1.2, 'üü¢ Similar Volume',\r\n    TargetGB < SourceGB * 0.8, 'üü† Lower in Target',\r\n    TargetGB > SourceGB * 1.2, 'üîµ Higher in Target',\r\n    '‚ö™ No Data'\r\n)\r\n| extend MigrationAction = case(\r\n    SourceGB > 0 and TargetGB == 0, '‚ö†Ô∏è Configure connector in target',\r\n    TargetGB < SourceGB * 0.5, '‚ö†Ô∏è Check data flow configuration',\r\n    TargetGB >= SourceGB * 0.8, '‚úÖ Migration on track',\r\n    ''\r\n)\r\n| project DataType, SourceGB, TargetGB, Variance, VariancePercent, Status, MigrationAction\r\n| order by SourceGB desc",
                    "size": 0,
                    "title": "Data Ingestion Comparison - Last {TimeRange:label}",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "SourceGB",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          },
                          "numberFormat": {
                            "unit": 5,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "TargetGB",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "green"
                          },
                          "numberFormat": {
                            "unit": 5,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Variance",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 5,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "VariancePercent",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "greenRed"
                          },
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 1
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "SourceGB",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "SourceGB",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "name": "data-volume-comparison"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SourceTables = workspace('{SourceWorkspace}').Usage\r\n| summarize SourceVolume = sum(Quantity) by DataType, bin(TimeGenerated, 1d)\r\n| extend Workspace = 'Source';\r\nlet TargetTables = workspace('{Workspace}').Usage\r\n| summarize TargetVolume = sum(Quantity) by DataType, bin(TimeGenerated, 1d)\r\n| extend Workspace = 'Target';\r\nSourceTables\r\n| union TargetTables\r\n| extend Volume = coalesce(SourceVolume, TargetVolume)\r\n| project TimeGenerated, DataType, Workspace, Volume\r\n| order by TimeGenerated asc",
                    "size": 0,
                    "title": "Data Ingestion Trend Comparison Over {TimeRange:label}",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "visualization": "timechart"
                  },
                  "name": "trend-comparison"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let ConnectorMapping = datatable(TableName: string, ConnectorName: string, ConnectorType: string, SupportsMultiWorkspace: string)\r\n[\r\n    'SigninLogs', 'Azure Active Directory', 'Microsoft', 'Yes',\r\n    'AuditLogs', 'Azure Active Directory', 'Microsoft', 'Yes',\r\n    'AADNonInteractiveUserSignInLogs', 'Azure Active Directory', 'Microsoft', 'Yes',\r\n    'AADServicePrincipalSignInLogs', 'Azure Active Directory', 'Microsoft', 'Yes',\r\n    'SecurityAlert', 'Microsoft Defender for Cloud', 'Microsoft', 'Yes',\r\n    'SecurityIncident', 'Microsoft Sentinel', 'Microsoft', 'N/A',\r\n    'OfficeActivity', 'Office 365', 'Microsoft', 'Yes',\r\n    'AzureActivity', 'Azure Activity', 'Microsoft', 'Yes',\r\n    'DeviceEvents', 'Microsoft 365 Defender', 'Microsoft', 'Yes',\r\n    'DeviceInfo', 'Microsoft 365 Defender', 'Microsoft', 'Yes',\r\n    'DeviceNetworkEvents', 'Microsoft 365 Defender', 'Microsoft', 'Yes',\r\n    'DeviceProcessEvents', 'Microsoft 365 Defender', 'Microsoft', 'Yes',\r\n    'DeviceFileEvents', 'Microsoft 365 Defender', 'Microsoft', 'Yes',\r\n    'EmailEvents', 'Microsoft 365 Defender', 'Microsoft', 'Yes',\r\n    'EmailAttachmentInfo', 'Microsoft 365 Defender', 'Microsoft', 'Yes',\r\n    'IdentityLogonEvents', 'Microsoft 365 Defender', 'Microsoft', 'Yes',\r\n    'CloudAppEvents', 'Microsoft 365 Defender', 'Microsoft', 'Yes',\r\n    'SecurityEvent', 'Windows Security Events', 'Agent-based', 'No',\r\n    'WindowsEvent', 'Windows Security Events (AMA)', 'Agent-based', 'No',\r\n    'Syslog', 'Syslog', 'Agent-based', 'No',\r\n    'CommonSecurityLog', 'Common Event Format (CEF)', 'Agent-based', 'No',\r\n    'W3CIISLog', 'IIS Logs', 'Agent-based', 'No',\r\n    'AWSCloudTrail', 'Amazon Web Services', 'Third-party', 'Varies',\r\n    'AzureDiagnostics', 'Azure Diagnostic Logs', 'Microsoft', 'Yes'\r\n];\r\nlet SourceTables = workspace('{SourceWorkspace}').Usage\r\n| distinct DataType\r\n| extend SourceTable = DataType;\r\nlet TargetTables = workspace('{Workspace}').Usage\r\n| distinct DataType\r\n| extend TargetTable = DataType;\r\nConnectorMapping\r\n| join kind=leftouter (SourceTables) on $left.TableName == $right.SourceTable\r\n| extend InSource = isnotnull(SourceTable)\r\n| join kind=leftouter (TargetTables) on $left.TableName == $right.TargetTable\r\n| extend InTarget = isnotnull(TargetTable)\r\n| project ConnectorName, ConnectorType, TableName, SupportsMultiWorkspace, InSource, InTarget\r\n| extend Status = case(\r\n    InSource and InTarget, 'üü¢ Active in Both',\r\n    InSource and not(InTarget), 'üî¥ Missing in Target',\r\n    not(InSource) and InTarget, 'üü° New in Target',\r\n    '‚ö™ Not in Either'\r\n)\r\n| extend MigrationPriority = case(\r\n    InSource and not(InTarget) and SupportsMultiWorkspace == 'Yes', 'HIGH - Easy to enable in both',\r\n    InSource and not(InTarget) and SupportsMultiWorkspace == 'No', 'MEDIUM - Requires cutover planning',\r\n    InSource and InTarget, 'COMPLETE',\r\n    ''\r\n)\r\n| where InSource or InTarget\r\n| summarize Tables = make_set(TableName), Status = max(Status), MigrationPriority = max(MigrationPriority) by ConnectorName, ConnectorType, SupportsMultiWorkspace\r\n| order by MigrationPriority desc, ConnectorType asc, ConnectorName asc",
                    "size": 0,
                    "title": "Connector Migration Status",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "MigrationPriority",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "contains",
                                "thresholdValue": "HIGH",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "contains",
                                "thresholdValue": "MEDIUM",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "COMPLETE",
                                "representation": "green",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "representation": "gray",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "filter": true
                    }
                  },
                  "name": "connector-migration-status"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "---\r\n### Free Tier Connectors Comparison"
                  },
                  "name": "free-tier-header"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SourceSharePoint = workspace('{SourceWorkspace}').OfficeActivity | where OfficeWorkload has 'SharePoint' | summarize count() | extend isEnabled = iff(count_ > 0, 'Source', 'No') | extend Table = 'SharePoint';\r\nlet TargetSharePoint = workspace('{Workspace}').OfficeActivity | where OfficeWorkload has 'SharePoint' | summarize count() | extend isEnabled = iff(count_ > 0, 'Target', 'No') | extend Table = 'SharePoint';\r\nlet SourceExchange = workspace('{SourceWorkspace}').OfficeActivity | where OfficeWorkload has 'Exchange' | summarize count() | extend isEnabled = iff(count_ > 0, 'Source', 'No') | extend Table = 'Exchange';\r\nlet TargetExchange = workspace('{Workspace}').OfficeActivity | where OfficeWorkload has 'Exchange' | summarize count() | extend isEnabled = iff(count_ > 0, 'Target', 'No') | extend Table = 'Exchange';\r\nlet SourceTeams = workspace('{SourceWorkspace}').OfficeActivity | where OfficeWorkload has 'MicrosoftTeams' | summarize count() | extend isEnabled = iff(count_ > 0, 'Source', 'No') | extend Table = 'Teams';\r\nlet TargetTeams = workspace('{Workspace}').OfficeActivity | where OfficeWorkload has 'MicrosoftTeams' | summarize count() | extend isEnabled = iff(count_ > 0, 'Target', 'No') | extend Table = 'Teams';\r\nlet SourceOneDrive = workspace('{SourceWorkspace}').OfficeActivity | where OfficeWorkload has 'OneDrive' | summarize count() | extend isEnabled = iff(count_ > 0, 'Source', 'No') | extend Table = 'OneDrive';\r\nlet TargetOneDrive = workspace('{Workspace}').OfficeActivity | where OfficeWorkload has 'OneDrive' | summarize count() | extend isEnabled = iff(count_ > 0, 'Target', 'No') | extend Table = 'OneDrive';\r\nlet SourceAA = workspace('{SourceWorkspace}').AzureActivity | summarize count() | extend isEnabled = iff(count_ > 0, 'Source', 'No') | extend Table = 'AzureActivity';\r\nlet TargetAA = workspace('{Workspace}').AzureActivity | summarize count() | extend isEnabled = iff(count_ > 0, 'Target', 'No') | extend Table = 'AzureActivity';\r\nlet SourceDFC = workspace('{SourceWorkspace}').SecurityAlert | where ProviderName has 'Azure Security Center' | summarize count() | extend Table = 'Defender for Cloud Alerts' | extend isEnabled = iff(count_ > 0, 'Source', 'No');\r\nlet TargetDFC = workspace('{Workspace}').SecurityAlert | where ProviderName has 'Azure Security Center' | summarize count() | extend Table = 'Defender for Cloud Alerts' | extend isEnabled = iff(count_ > 0, 'Target', 'No');\r\nSourceSharePoint | union TargetSharePoint, SourceExchange, TargetExchange, SourceTeams, TargetTeams, SourceOneDrive, TargetOneDrive, SourceAA, TargetAA, SourceDFC, TargetDFC\r\n| summarize Workspaces = make_set(isEnabled) by Table\r\n| extend Status = case(\r\n    Workspaces has 'Source' and Workspaces has 'Target', 'üü¢ Both',\r\n    Workspaces has 'Source' and not(Workspaces has 'Target'), 'üî¥ Source Only',\r\n    not(Workspaces has 'Source') and Workspaces has 'Target', 'üü° Target Only',\r\n    '‚ö™ Neither'\r\n)\r\n| project Table, Status\r\n| order by Table asc",
                    "size": 0,
                    "title": "Free Tier Connector Status - Source vs Target",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "filter": true
                    }
                  },
                  "name": "free-tier-comparison"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Compare"
            },
            "name": "comparison-view"
          },
          {
            "type": 1,
            "content": {
              "json": "### Please note that any deployment performed in this section will apply to the TARGET workspace ({Workspace:name}), NOT the source workspace.",
              "style": "warning"
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "text - 12"
          },
          {
            "type": 1,
            "content": {
              "json": "### Instructions for Sentinel-to-Sentinel Migration\r\n\r\n**Configuring Target Workspace Connectors:**\r\n\r\n1. Review the comparison view to identify which connectors are missing in the target workspace\r\n2. Click on the connector buttons below to navigate to the target workspace connector page\r\n3. Configure the connector following the instructions on the connector page\r\n4. For multi-workspace connectors (Office 365, M365 Defender, etc.), enable data flow to BOTH workspaces during migration\r\n5. For single-destination connectors (CEF, Syslog, Agents), plan the cutover carefully\r\n6. Return to the comparison view to validate data is flowing\r\n\r\n**Multi-Workspace Connector Strategy:**\r\n- These can send data to both workspaces simultaneously\r\n- Enable in target workspace WITHOUT disabling source\r\n- Monitor both workspaces during parallel operation\r\n- Low risk of data loss\r\n\r\n**Single-Destination Connector Strategy:**\r\n- Can only send to ONE workspace at a time\r\n- Requires careful cutover planning\r\n- Consider deploying additional forwarders for parallel operation\r\n- Higher risk - plan maintenance windows\r\n",
              "style": "info"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "Instructions",
                "comparison": "isEqualTo",
                "value": "Yes"
              },
              {
                "parameterName": "View",
                "comparison": "isEqualTo",
                "value": "Configure"
              }
            ],
            "name": "sentinel-configure-instructions"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Free Tier Connectors (Multi-Workspace Supported)",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "‚úÖ **These connectors support sending data to multiple workspaces simultaneously**\r\n\r\nSafe to enable in target workspace without affecting source workspace."
                  },
                  "name": "multi-workspace-note"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "6a86eb8d-5487-4aad-ae7b-b526e68a249f",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Open O365 Connector (Target)",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "DataConnectorBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "dataConnectorId",
                              "source": "static",
                              "value": "Office365"
                            }
                          ]
                        }
                      },
                      {
                        "id": "d17f28d6-18cf-4986-9db5-d3bd821951f0",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Open M365D Alerts Connector (Target)",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "DataConnectorBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "dataConnectorId",
                              "source": "static",
                              "value": "MicrosoftThreatProtection"
                            }
                          ]
                        }
                      },
                      {
                        "id": "56600b70-0e55-433a-be86-b7c561bced8b",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Open Defender for Cloud Alerts Connector (Target)",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "DataConnectorBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "dataConnectorId",
                              "source": "static",
                              "value": "AzureSecurityCenter"
                            }
                          ]
                        }
                      },
                      {
                        "id": "58cc25ab-a9af-4516-99e1-fa22e0637a76",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Open Azure Activity Connector (Target)",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "DataConnectorBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "dataConnectorId",
                              "source": "static",
                              "value": "AzureActivity"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "30",
                  "name": "links - 8"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SharePoint = (OfficeActivity | where OfficeWorkload has 'SharePoint' | summarize count() | extend isEnabled = iff(count_ > 0, 'True', 'False') | extend Table = 'SharePoint' | project Table, isEnabled);\r\nlet Exchange = (OfficeActivity | where OfficeWorkload has 'Exchange' | summarize count()| extend isEnabled = iff(count_ > 0, 'True', 'False') | extend Table = 'Exchange' | project Table, isEnabled);\r\nlet Teams = (OfficeActivity | where OfficeWorkload has 'MicrosoftTeams' | summarize count() | extend isEnabled = iff(count_ > 0, 'True', 'False')| extend Table = 'Teams' | project Table, isEnabled);\r\nlet OneDrive = (OfficeActivity | where OfficeWorkload has 'OneDrive' | summarize count() | extend isEnabled = iff(count_ > 0, 'True', 'False')| extend Table = 'OneDrive' | project Table, isEnabled);\r\nlet AA = (AzureActivity | summarize count() | extend isEnabled = iff(count_ > 0, 'True', 'False') | extend Table = 'AzureActivity' | project Table, isEnabled);\r\nlet DFC = (SecurityAlert | where ProviderName has 'Azure Security Center' | summarize count() | extend Table = 'Defender for Cloud Alerts' | extend isEnabled = iff(count_ > 0, 'True', 'False') | project Table, isEnabled);\r\nlet MCAS = (SecurityAlert | where ProviderName has 'MCAS' | summarize count() | extend Table = 'Defender for Cloud Apps Alerts' | extend isEnabled = iff(count_ > 0, 'True', 'False') | project Table, isEnabled);\r\nlet MDE = (SecurityAlert | where ProviderName has 'MDATP' | summarize count() | extend Table = 'Defender for Endpoint Alerts' | extend isEnabled = iff(count_ > 0, 'True', 'False') | project Table, isEnabled);\r\nlet MDO = (SecurityAlert | where ProviderName has 'OATP' | summarize count() | extend Table = 'Defender for Office Alerts' | extend isEnabled = iff(count_ > 0, 'True', 'False') | project Table, isEnabled);\r\nlet MDI = (SecurityAlert | where ProviderName has 'Azure Advanced Threat Protection' | summarize count() | extend Table = 'Defender for Identity Alerts' | extend isEnabled = iff(count_ > 0, 'True', 'False') | project Table, isEnabled);\r\nSharePoint\r\n| union Exchange, Teams, OneDrive, AA, DFC, MCAS, MDE, MDO, MDI\r\n| order by Table asc\r\n",
                    "size": 0,
                    "title": "Free Tier Connector Status (Target Workspace)",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "isEnabled",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "representation": "greenDark",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "False",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "70",
                  "name": "query - 1"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "FT"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Paid Tier Connectors",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "‚ö†Ô∏è **Mixed support for multi-workspace:**\r\n- **Multi-workspace supported:** Azure AD, M365 Defender Advanced Hunting\r\n- **Single workspace only:** Windows Events (Agent-based), CEF, Syslog\r\n\r\nPlan carefully for agent-based connectors that can only point to one workspace."
                  },
                  "name": "paid-tier-note"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "5252e79e-711f-4d8c-9194-c0d57f2dc226",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Open Microsoft Entra ID (Target)",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "DataConnectorBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "dataConnectorId",
                              "source": "static",
                              "value": "AzureActiveDirectory"
                            }
                          ]
                        }
                      },
                      {
                        "id": "423b442c-2f11-4e52-93af-a4dc16f210c2",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "‚ö†Ô∏è Open Windows Security Event (MMA) - SINGLE WORKSPACE",
                        "style": "secondary",
                        "bladeOpenContext": {
                          "bladeName": "DataConnectorBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "dataConnectorId",
                              "source": "static",
                              "value": "SecurityEvents"
                            }
                          ]
                        }
                      },
                      {
                        "id": "6c550017-1ddb-48a5-97e5-a2147b61ce52",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "‚ö†Ô∏è Open Windows Security Event (AMA) - SINGLE WORKSPACE",
                        "style": "secondary",
                        "bladeOpenContext": {
                          "bladeName": "DataConnectorBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "dataConnectorId",
                              "source": "static",
                              "value": "WindowsSecurityEvents"
                            }
                          ]
                        }
                      },
                      {
                        "id": "d830f81b-0d4c-4b9b-b9e9-0abc967122ab",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Open M365D Hunting Logs (Target)",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "DataConnectorBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "dataConnectorId",
                              "source": "static",
                              "value": "MicrosoftThreatProtection"
                            }
                          ]
                        }
                      },
                      {
                        "id": "6593338e-58f1-4846-a607-d8b855720373",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "‚ö†Ô∏è Open Syslog - SINGLE WORKSPACE",
                        "style": "secondary",
                        "bladeOpenContext": {
                          "bladeName": "DataConnectorBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "dataConnectorId",
                              "source": "static",
                              "value": "Syslog"
                            }
                          ]
                        }
                      },
                      {
                        "id": "05e7166b-f040-49a8-b610-9297f384e7e7",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "‚ö†Ô∏è Open CEF - SINGLE WORKSPACE",
                        "style": "secondary",
                        "bladeOpenContext": {
                          "bladeName": "DataConnectorBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "dataConnectorId",
                              "source": "static",
                              "value": "CEF"
                            }
                          ]
                        }
                      },
                      {
                        "id": "14c5e4c1-a15f-44c3-809d-b48ef872f16c",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Open Connector Gallery (Target)",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "DataConnectorsBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights"
                        }
                      },
                      {
                        "id": "86825f88-45e6-45fa-9b23-2b95b32a3416",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Open Content Hub (Target)",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "ContentHub.ReactView",
                          "extensionName": "Microsoft_Azure_SentinelUS",
                          "bladeParameters": [
                            {
                              "name": "subscriptionId",
                              "source": "static",
                              "value": "{Subscription:id}"
                            },
                            {
                              "name": "resourceGroup",
                              "source": "static",
                              "value": "{Workspace:resourcegroup}"
                            },
                            {
                              "name": "workspaceName",
                              "source": "static",
                              "value": "{Workspace:name}"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "40",
                  "name": "links - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SignIns = (SigninLogs | summarize count() | extend isEnabled = iff(count_ > 0, 'True', 'False') | extend Table = 'SigninLogs' | project Table, isEnabled);\r\nlet Audits = (AuditLogs | summarize count()| extend isEnabled = iff(count_ > 0, 'True', 'False') | extend Table = 'AuditLogs' | project Table, isEnabled);\r\nlet NonInt = (AADNonInteractiveUserSignInLogs | summarize count() | extend isEnabled = iff(count_ > 0, 'True', 'False')| extend Table = 'AADNonInteractive' | project Table, isEnabled);\r\nlet SPS = (AADServicePrincipalSignInLogs  | summarize count() | extend isEnabled = iff(count_ > 0, 'True', 'False')| extend Table = 'Service Princpal Sign-in' | project Table, isEnabled);\r\nlet SE = (SecurityEvent | summarize count() | extend Table = 'Windows Security Events' | extend isEnabled = iff(count_ > 0, 'True', 'False') | project Table, isEnabled);\r\nlet WE = (WindowsEvent | summarize count() | extend Table = 'Windows Events' | extend isEnabled = iff(count_ > 0, 'True', 'False') | project Table, isEnabled);\r\nlet SL = (Syslog | summarize count() | extend Table = 'Syslog' | extend isEnabled = iff(count_ > 0, 'True', 'False') | project Table, isEnabled);\r\nlet CSL = (CommonSecurityLog | summarize count() | extend Table = 'CEF' | extend isEnabled = iff(count_ > 0, 'True', 'False') | project Table, isEnabled);\r\nlet DVI = (DeviceInfo | summarize count() | extend Table = 'MDE Device Info' | extend isEnabled = iff(count_ > 0, 'True', 'False') | project Table, isEnabled);\r\nlet DPE = (DeviceProcessEvents | summarize count() | extend Table = 'MDE Device Process Events' | extend isEnabled = iff(count_ > 0, 'True', 'False') | project Table, isEnabled);\r\nlet EV = (EmailEvents | summarize count() | extend Table = 'MDO Email Events' | extend isEnabled = iff(count_ > 0, 'True', 'False') | project Table, isEnabled);\r\nlet ILE = (IdentityLogonEvents | summarize count() | extend Table = 'MDI Logon Events' | extend isEnabled = iff(count_ > 0, 'True', 'False') | project Table, isEnabled);\r\nSignIns\r\n| union Audits, NonInt, SPS, SE, WE, SL, CSL, DVI, DPE, EV, ILE\r\n| order by Table asc\r\n",
                    "size": 0,
                    "title": "Commonly Used Paid Tier Connector Status (Target Workspace)",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "isEnabled",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "representation": "greenDark",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "False",
                                "representation": "redBright",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "60",
                  "name": "query - 1"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "PT"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "union *\r\n| where TimeGenerated > startofday(ago(31d))\r\n| summarize GBytes = sum(_BilledSize)/(1024*1024*1024) by bin(TimeGenerated, 1d)",
              "size": 0,
              "title": "Data Ingestion Over Last {TimeRange} (Target Workspace)",
              "timeContextFromParameter": "TimeRange",
              "timeBrushParameterName": "TimeRange",
              "timeBrushExportOnlyWhenBrushed": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "linechart"
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Monitor"
            },
            "name": "query - 7"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "union withsource=TableName1 *\r\n| where TimeGenerated {TimeRange:query}\r\n| summarize Entries = count(), Size = sum(_BilledSize), last_log = datetime_diff(\"second\",now(), max(TimeGenerated)), estimate  = sumif(_BilledSize, _IsBillable==true)  by TableName1, _IsBillable\r\n| project ['Table Name'] = TableName1, ['Table Size'] = Size, ['Table Entries'] = Entries,\r\n          ['Size per Entry'] = 1.0 * Size / Entries, ['IsBillable'] = _IsBillable, ['Latest Record Created'] =  last_log\r\n | order by ['Table Size']  desc\r\n",
              "size": 0,
              "showAnalytics": true,
              "title": "{Workspace:name} Status for {TimeRange:label}",
              "timeContextFromParameter": "TimeRange",
              "exportFieldName": "Table Name",
              "exportParameterName": "Table",
              "exportDefaultValue": "All Tables",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Table Name",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "Table Size",
                    "formatter": 3,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Table Entries",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "green"
                    },
                    "numberFormat": {
                      "unit": 17,
                      "options": {
                        "style": "decimal",
                        "useGrouping": false
                      }
                    }
                  },
                  {
                    "columnMatch": "Size per Entry",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "palette": "orange"
                    },
                    "numberFormat": {
                      "unit": 2,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "IsBillable",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "green",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "False",
                          "representation": "blueDark",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "representation": "blue",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Latest Record Created",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 24,
                      "options": {
                        "style": "decimal"
                      }
                    },
                    "tooltipFormat": {
                      "tooltip": "Time when record was created at data source"
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_bar_Table Size_1",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_bar_Table Size_1",
                  "sortOrder": 2
                }
              ]
            },
            "customWidth": "70",
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Monitor"
            },
            "name": "query - 2"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Usage\r\n| summarize by DataType\r\n| sort by DataType asc",
              "size": 0,
              "title": "Data Tables Configured (Target)",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "rowLimit": 500,
                "filter": true
              }
            },
            "customWidth": "15",
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Monitor"
            },
            "name": "query - 1"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "Usage\r\n| distinct DataType\r\n| summarize count()",
              "size": 0,
              "title": "Total Data Sources (Target)",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "card",
              "tileSettings": {
                "showBorder": false
              }
            },
            "customWidth": "15",
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Monitor"
            },
            "name": "total-sources-card"
          },
          {
            "type": 1,
            "content": {
              "json": "----------------------------------------------------------------------------------------------------\r\n\r\n# Health Monitoring (Target Workspace)"
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Monitor"
            },
            "name": "text - 4"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SentinelHealth\r\n| where OperationName has 'data fetch status change' or OperationName has 'data fetch failure summary'\r\n| summarize count() by OperationName, bin(TimeGenerated, 1d)",
              "size": 0,
              "title": "Data Connector Changes and Failures Over Last {TimeRange} (Target)",
              "timeContextFromParameter": "TimeRange",
              "timeBrushParameterName": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "linechart"
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Monitor"
            },
            "name": "query - 5"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SentinelHealth\r\n| where SentinelResourceType has 'Data connector'\r\n| project TimeGenerated, OperationName, SentinelResourceName, Status, Description\r\n| order by TimeGenerated desc\r\n",
              "size": 0,
              "title": "Data Connector Health Logs (Target)",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "rowLimit": 1000,
                "filter": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Monitor"
            },
            "name": "query - 23"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "DC"
      },
      "name": "DC",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Data Collection Rules (DCRs)\r\n\r\nData Collection Rules are a critical component of modern data ingestion in Azure Monitor and Microsoft Sentinel. DCRs define how data is collected, transformed, and routed to destinations.\r\n\r\n### Migration Guidance\r\n\r\n**Why DCRs Matter for Migration:**\r\n- DCRs control data ingestion and transformation pipelines\r\n- Custom logs and some data connectors require DCRs\r\n- DCRs enable data transformation and filtering to reduce costs\r\n- Workspace-specific: Must be recreated or updated for new workspace\r\n\r\n**Migration Steps:**\r\n1. **Inventory**: Document all DCRs in source workspace\r\n2. **Review**: Identify workspace-specific references (workspace IDs, resource IDs)\r\n3. **Export**: Use ARM templates or Azure CLI to export DCR configurations\r\n4. **Update**: Modify workspace references to point to target workspace\r\n5. **Deploy**: Create DCRs in target workspace\r\n6. **Test**: Verify data is flowing correctly to target workspace\r\n7. **Monitor**: Check data ingestion metrics and troubleshoot issues\r\n\r\n**Key Considerations:**\r\n- DCRs are subscription-scoped but reference specific workspaces\r\n- Data transformation rules must be reviewed for compatibility\r\n- Some connectors auto-create DCRs (e.g., AMA-based connectors)\r\n- Custom logs using DCR-based API require DCR updates\r\n\r\n**Documentation:**\r\n- [Data Collection Rules Overview](https://learn.microsoft.com/azure/azure-monitor/essentials/data-collection-rule-overview)\r\n- [Create and edit DCRs](https://learn.microsoft.com/azure/azure-monitor/essentials/data-collection-rule-create-edit)\r\n- [Data collection transformations](https://learn.microsoft.com/azure/azure-monitor/essentials/data-collection-transformations)",
              "style": "info"
            },
            "name": "DCR-Overview"
          },
          {
            "type": 1,
            "content": {
              "json": "### Source Workspace DCRs\r\n\r\nReview the Data Collection Rules configured in your **source** workspace. These will need to be recreated or updated to point to the target workspace."
            },
            "name": "DCR-SourceLabel"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.Insights/dataCollectionRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.properties.destinations.logAnalytics[0].workspaceResourceId\",\"columnid\":\"WorkspaceId\"},{\"path\":\"$.name\",\"columnid\":\"DCRName\"},{\"path\":\"$.location\",\"columnid\":\"Location\"},{\"path\":\"$.properties.dataSources.performanceCounters[*].name\",\"columnid\":\"PerfCounters\"},{\"path\":\"$.properties.dataSources.windowsEventLogs[*].name\",\"columnid\":\"WindowsEvents\"},{\"path\":\"$.properties.dataSources.syslog[*].name\",\"columnid\":\"Syslog\"},{\"path\":\"$.properties.dataSources.extensions[*].name\",\"columnid\":\"Extensions\"},{\"path\":\"$.properties.destinations.logAnalytics[*].name\",\"columnid\":\"Destinations\"},{\"path\":\"$.properties.dataFlows[*].transformKql\",\"columnid\":\"HasTransformation\"},{\"path\":\"$.id\",\"columnid\":\"ResourceId\"}]}}]}",
              "size": 1,
              "title": "üìä Source Workspace DCRs - {SourceWorkspace:name}",
              "noDataMessage": "No Data Collection Rules found pointing to the source workspace. This may be normal if you're not using DCR-based data collection.",
              "showRefreshButton": true,
              "exportToExcelOptions": "all",
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "DCRName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Location",
                    "formatter": 0
                  },
                  {
                    "columnMatch": "PerfCounters",
                    "formatter": 0
                  },
                  {
                    "columnMatch": "WindowsEvents",
                    "formatter": 0
                  },
                  {
                    "columnMatch": "Syslog",
                    "formatter": 0
                  },
                  {
                    "columnMatch": "Extensions",
                    "formatter": 0
                  },
                  {
                    "columnMatch": "Destinations",
                    "formatter": 0
                  },
                  {
                    "columnMatch": "HasTransformation",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "is Empty",
                          "representation": "Blank",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "Yes"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ResourceId",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkLabel": "Open DCR"
                    }
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "DCRName",
                    "label": "DCR Name"
                  },
                  {
                    "columnId": "PerfCounters",
                    "label": "Performance Counters"
                  },
                  {
                    "columnId": "WindowsEvents",
                    "label": "Windows Events"
                  },
                  {
                    "columnId": "Extensions",
                    "label": "Extensions (AMA, etc)"
                  },
                  {
                    "columnId": "HasTransformation",
                    "label": "Data Transformation"
                  },
                  {
                    "columnId": "ResourceId",
                    "label": "Actions"
                  }
                ]
              }
            },
            "name": "DCR-SourceList"
          },
          {
            "type": 1,
            "content": {
              "json": "### Target Workspace DCRs\r\n\r\nReview the Data Collection Rules configured in your **target** workspace. Ensure migrated DCRs are functioning correctly."
            },
            "name": "DCR-TargetLabel"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.Insights/dataCollectionRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.properties.destinations.logAnalytics[0].workspaceResourceId\",\"columnid\":\"WorkspaceId\"},{\"path\":\"$.name\",\"columnid\":\"DCRName\"},{\"path\":\"$.location\",\"columnid\":\"Location\"},{\"path\":\"$.properties.dataSources.performanceCounters[*].name\",\"columnid\":\"PerfCounters\"},{\"path\":\"$.properties.dataSources.windowsEventLogs[*].name\",\"columnid\":\"WindowsEvents\"},{\"path\":\"$.properties.dataSources.syslog[*].name\",\"columnid\":\"Syslog\"},{\"path\":\"$.properties.dataSources.extensions[*].name\",\"columnid\":\"Extensions\"},{\"path\":\"$.properties.destinations.logAnalytics[*].name\",\"columnid\":\"Destinations\"},{\"path\":\"$.properties.dataFlows[*].transformKql\",\"columnid\":\"HasTransformation\"},{\"path\":\"$.id\",\"columnid\":\"ResourceId\"}]}}]}",
              "size": 1,
              "title": "üìä Target Workspace DCRs - {Workspace:name}",
              "noDataMessage": "No Data Collection Rules found pointing to the target workspace. Ensure you have migrated or created DCRs for your data sources.",
              "showRefreshButton": true,
              "exportToExcelOptions": "all",
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "DCRName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Location",
                    "formatter": 0
                  },
                  {
                    "columnMatch": "PerfCounters",
                    "formatter": 0
                  },
                  {
                    "columnMatch": "WindowsEvents",
                    "formatter": 0
                  },
                  {
                    "columnMatch": "Syslog",
                    "formatter": 0
                  },
                  {
                    "columnMatch": "Extensions",
                    "formatter": 0
                  },
                  {
                    "columnMatch": "Destinations",
                    "formatter": 0
                  },
                  {
                    "columnMatch": "HasTransformation",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "is Empty",
                          "representation": "Blank",
                          "text": "No"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "Yes"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "ResourceId",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkLabel": "Open DCR"
                    }
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "DCRName",
                    "label": "DCR Name"
                  },
                  {
                    "columnId": "PerfCounters",
                    "label": "Performance Counters"
                  },
                  {
                    "columnId": "WindowsEvents",
                    "label": "Windows Events"
                  },
                  {
                    "columnId": "Extensions",
                    "label": "Extensions (AMA, etc)"
                  },
                  {
                    "columnId": "HasTransformation",
                    "label": "Data Transformation"
                  },
                  {
                    "columnId": "ResourceId",
                    "label": "Actions"
                  }
                ]
              }
            },
            "name": "DCR-TargetList"
          },
          {
            "type": 1,
            "content": {
              "json": "### Migration Actions\r\n\r\n**PowerShell Export Example:**\r\n```powershell\r\n# Export DCR from source\r\n$sourceDCR = Get-AzDataCollectionRule -ResourceGroupName \"source-rg\" -Name \"dcr-name\"\r\n$sourceDCR | ConvertTo-Json -Depth 10 | Out-File \"dcr-export.json\"\r\n\r\n# Update workspace reference in exported JSON\r\n# Then import to target\r\nNew-AzDataCollectionRule -ResourceGroupName \"target-rg\" -Name \"dcr-name\" -JsonFilePath \"dcr-export-updated.json\"\r\n```\r\n\r\n**Azure CLI Export Example:**\r\n```bash\r\n# Export DCR configuration\r\naz monitor data-collection rule show --name \"dcr-name\" --resource-group \"source-rg\" > dcr-export.json\r\n\r\n# Create in target (after updating workspace references)\r\naz monitor data-collection rule create --name \"dcr-name\" --resource-group \"target-rg\" --rule-file dcr-export-updated.json\r\n```\r\n\r\n**Important:** Update all references to the source workspace ID with the target workspace ID before deploying.",
              "style": "warning"
            },
            "name": "DCR-MigrationActions"
          },
          {
            "type": 1,
            "content": {
              "json": "### üîç DCR Duplication Detection\n\nIdentify potential duplicate data collection by analyzing which Security Event IDs are collected by multiple DCRs. This can help optimize costs and reduce redundant data ingestion.\n\n**How to use:**\n- Review the table below to see Event IDs collected by multiple DCRs\n- Check the GB ingestion to prioritize optimization efforts\n- Consider consolidating DCRs that collect overlapping events"
            },
            "name": "DCR-Duplication-Header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\n| where TimeGenerated > ago(30d)\n| where _IsBillable == true\n| summarize GBytes = round(sum(_BilledSize)/(1024*1024*1024), 2), EventCount = count() by EventID\n| extend EstimatedCostUSD = round(GBytes * 2.30, 2)\n| order by GBytes desc\n| take 25",
              "size": 0,
              "title": "üìä Top 25 Security Event IDs by Ingestion Cost - Source Workspace (Last 30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{SourceWorkspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "GBytes",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "EventCount",
                    "formatter": 4,
                    "formatOptions": {
                      "min": 0,
                      "palette": "gray"
                    }
                  },
                  {
                    "columnMatch": "EstimatedCostUSD",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": null,
                      "palette": "greenRed"
                    }
                  }
                ],
                "rowLimit": 2000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "EventID",
                    "label": "Event ID"
                  },
                  {
                    "columnId": "GBytes",
                    "label": "GB Ingested"
                  },
                  {
                    "columnId": "EventCount",
                    "label": "Event Count"
                  },
                  {
                    "columnId": "EstimatedCostUSD",
                    "label": "Est. Cost (USD)"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "DCR-CostAnalysis-Source"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\n| where TimeGenerated > ago(30d)\n| where _IsBillable == true\n| summarize GBytes = round(sum(_BilledSize)/(1024*1024*1024), 2), EventCount = count() by EventID\n| extend EstimatedCostUSD = round(GBytes * 2.30, 2)\n| order by GBytes desc\n| take 25",
              "size": 0,
              "title": "üìä Top 25 Security Event IDs by Ingestion Cost - Target Workspace (Last 30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "noDataMessage": "No data in target workspace yet, or target workspace has no Security Events.",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "GBytes",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "EventCount",
                    "formatter": 4,
                    "formatOptions": {
                      "min": 0,
                      "palette": "gray"
                    }
                  },
                  {
                    "columnMatch": "EstimatedCostUSD",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed"
                    }
                  }
                ],
                "rowLimit": 2000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "EventID",
                    "label": "Event ID"
                  },
                  {
                    "columnId": "GBytes",
                    "label": "GB Ingested"
                  },
                  {
                    "columnId": "EventCount",
                    "label": "Event Count"
                  },
                  {
                    "columnId": "EstimatedCostUSD",
                    "label": "Est. Cost (USD)"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "DCR-CostAnalysis-Target"
          },
          {
            "type": 1,
            "content": {
              "json": "### üìà DCR Ingestion Trends\n\nMonitor daily ingestion trends to identify patterns and validate migration success."
            },
            "name": "DCR-Trends-Header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\n| where TimeGenerated > ago(30d)\n| where _IsBillable == true\n| summarize GBytes = sum(_BilledSize)/(1024*1024*1024) by bin(TimeGenerated, 1d)\n| order by TimeGenerated asc",
              "size": 0,
              "title": "Daily Security Event Ingestion - Source Workspace (Last 30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{SourceWorkspace}"
              ],
              "visualization": "timechart",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "GBytes",
                    "label": "GB/Day"
                  }
                ],
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  }
                }
              }
            },
            "customWidth": "50",
            "name": "DCR-Trends-Source"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityEvent\n| where TimeGenerated > ago(30d)\n| where _IsBillable == true\n| summarize GBytes = sum(_BilledSize)/(1024*1024*1024) by bin(TimeGenerated, 1d)\n| order by TimeGenerated asc",
              "size": 0,
              "title": "Daily Security Event Ingestion - Target Workspace (Last 30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "noDataMessage": "No data in target workspace yet. This chart will populate once migration begins.",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "timechart",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "GBytes",
                    "label": "GB/Day"
                  }
                ],
                "ySettings": {
                  "numberFormatSettings": {
                    "unit": 0,
                    "options": {
                      "style": "decimal",
                      "useGrouping": true
                    }
                  }
                }
              }
            },
            "customWidth": "50",
            "name": "DCR-Trends-Target"
          },
          {
            "type": 1,
            "content": {
              "json": "### üîß DCR Resource Associations\n\nTrack which virtual machines and resources are associated with your Data Collection Rules.\n\n**Migration Note:** After migrating a DCR to the target workspace, you'll need to update resource associations to point to the new DCR."
            },
            "name": "DCR-Associations-Header"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "dcr-selection-param",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedDCR",
                  "label": "Select DCR to view associations",
                  "type": 2,
                  "description": "Choose a DCR from the source workspace to see its resource associations",
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/providers/Microsoft.Insights/dataCollectionRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.id\",\"columnid\":\"value\"},{\"path\":\"$.name\",\"columnid\":\"label\"},{\"path\":\"$.properties.destinations.logAnalytics[0].workspaceResourceId\",\"columnid\":\"workspace\"}]}}]}",
                  "typeSettings": {
                    "additionalResourceOptions": [
                      "value::1"
                    ],
                    "showDefault": false
                  },
                  "queryType": 12,
                  "value": null
                },
                {
                  "id": "dcr-rg-param",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedDCR_RG",
                  "type": 1,
                  "description": "Resource group of selected DCR",
                  "query": "print resourceGroup = split('{SelectedDCR}', '/')[4]",
                  "isHiddenWhenLocked": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                },
                {
                  "id": "dcr-name-param",
                  "version": "KqlParameterItem/1.0",
                  "name": "SelectedDCR_Name",
                  "type": 1,
                  "description": "Name of selected DCR",
                  "query": "print dcrName = split('{SelectedDCR}', '/')[8]",
                  "isHiddenWhenLocked": true,
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "DCR-Association-Params"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{SelectedDCR_RG}/providers/Microsoft.Insights/dataCollectionRules/{SelectedDCR_Name}/associations\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-06-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.name\",\"columnid\":\"AssociationName\"},{\"path\":\"$.id\",\"columnid\":\"ResourceId\",\"substringRegexMatch\":\"(\\\\/subscriptions\\\\/[^\\\\/]+\\\\/resourceGroups\\\\/[^\\\\/]+\\\\/providers\\\\/[^\\\\/]+\\\\/[^\\\\/]+\\\\/[^\\\\/]+).*\",\"substringReplace\":\"$1\"},{\"path\":\"$.properties.dataCollectionRuleId\",\"columnid\":\"DCRId\"}]}}]}",
              "size": 0,
              "title": "üñ•Ô∏è Resources Associated with {SelectedDCR_Name}",
              "noDataMessage": "No associations found for this DCR, or no DCR selected above.",
              "showRefreshButton": true,
              "exportToExcelOptions": "all",
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AssociationName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ResourceId",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkLabel": "View Resource",
                      "linkIsContextBlade": false,
                      "showIcon": true
                    }
                  },
                  {
                    "columnMatch": "DCRId",
                    "formatter": 5
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "AssociationName",
                    "label": "Association Name"
                  },
                  {
                    "columnId": "ResourceId",
                    "label": "Associated Resource"
                  },
                  {
                    "columnId": "DCRId",
                    "label": "DCR ID"
                  }
                ]
              }
            },
            "name": "DCR-Associations-List"
          },
          {
            "type": 1,
            "content": {
              "json": "### üí° Migration Quick Actions\n\n**Generate PowerShell Script to Recreate Associations:**\n\n```powershell\n# After creating the DCR in the target workspace, run this script to reassociate resources\n# Replace $targetDCRId with your new DCR's resource ID\n\n$targetDCRId = \"/subscriptions/{Subscription:id}/resourceGroups/TARGET-RG/providers/Microsoft.Insights/dataCollectionRules/NEW-DCR-NAME\"\n\n# Get all current associations from source DCR\n$associations = Get-AzDataCollectionRuleAssociation -ResourceGroupName \"{SelectedDCR_RG}\" -DataCollectionRuleName \"{SelectedDCR_Name}\"\n\nforeach ($assoc in $associations) {\n    $targetResourceId = $assoc.TargetResourceId\n    $associationName = \"dcr-assoc-\" + (Get-Random -Maximum 99999)\n    \n    Write-Host \"Creating association for: $targetResourceId\"\n    \n    New-AzDataCollectionRuleAssociation `\n        -TargetResourceId $targetResourceId `\n        -AssociationName $associationName `\n        -DataCollectionRuleId $targetDCRId\n}\n\nWrite-Host \"‚úÖ All associations recreated successfully!\"\n```\n\n**Azure CLI Alternative:**\n\n```bash\n# Set variables\nTARGET_DCR_ID=\"/subscriptions/{Subscription:id}/resourceGroups/TARGET-RG/providers/Microsoft.Insights/dataCollectionRules/NEW-DCR-NAME\"\nSOURCE_RG=\"{SelectedDCR_RG}\"\nSOURCE_DCR=\"{SelectedDCR_Name}\"\n\n# Get associations and recreate\naz monitor data-collection rule association list \\\n  --resource-group $SOURCE_RG \\\n  --rule-name $SOURCE_DCR \\\n  --query \"[].{resourceId:split(id, '/providers/Microsoft.Insights')[0]}\" \\\n  --output tsv | while read RESOURCE_ID; do\n  \n  ASSOC_NAME=\"dcr-assoc-$RANDOM\"\n  \n  az monitor data-collection rule association create \\\n    --name $ASSOC_NAME \\\n    --resource $RESOURCE_ID \\\n    --rule-id $TARGET_DCR_ID\n    \n  echo \"‚úÖ Created association for $RESOURCE_ID\"\ndone\n```"
            },
            "name": "DCR-Migration-Scripts"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "DCR"
      },
      "name": "DCR",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "d6c87839-0036-4c48-9898-d4ecdc79394a",
                  "version": "KqlParameterItem/1.0",
                  "name": "ActiveRules",
                  "type": 1,
                  "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{Workspace:resourcegroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/alertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-10-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.properties.enabled\",\"columnid\":\"Enabled\"}]}}]}",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 12
                }
              ],
              "style": "pills",
              "queryType": 12
            },
            "name": "Analytic rules - Parameter"
          },
          {
            "type": 1,
            "content": {
              "json": "### Analytics Rules Migration\r\n\r\n*General Tips and Guidance*\r\n<p>\r\n- Review and document all active analytics rules in the source workspace </br>\r\n- Identify critical rules that must be migrated first </br>\r\n- Export analytics rules from the source workspace using ARM templates or the API </br>\r\n- Review rule configurations for workspace-specific dependencies </br>\r\n- Update workspace references, table names, and connection strings as needed </br>\r\n- Test rules in the target workspace before fully enabling them </br>\r\n- Consider rule performance and optimization opportunities during migration </br>\r\n</p>\r\n\r\n*Migration Approaches* \r\n<p>\r\n- **ARM Templates**: Export rules as ARM templates and redeploy to target workspace </br>\r\n- **API/PowerShell**: Use Azure API or PowerShell to automate rule migration </br>\r\n- **Manual Recreation**: For complex rules, consider recreating with optimizations </br>\r\n- **Validation**: Test each rule with historical data before enabling alerts </br>\r\n</p>\r\n\r\nLooking for help on KQL? Deploy the **Intro to KQL workbook** or the **Advanced KQL for Microsoft Sentinel workbook** on the Workbooks tab.\r\n\r\nFor insights on deploying side-by-side, please refer to https://docs.microsoft.com/azure/sentinel/deploy-side-by-side",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "MigrationTips",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "text - 13"
          },
          {
            "type": 1,
            "content": {
              "json": "### Instructions\r\n\r\nThis page is built into multiple sections:\r\n- Analytic rule status\r\n- Detections and incidents\r\n- Connector health\r\n\r\nFor reviewing analytics:\r\n1. Review the list of analytics below. Use the search bar if looking for a single template status. </br>\r\n2. Use the buttons to open the MITRE blade to review coverage or the analytics gallery to deploy the templates of interest. </br>\r\n\r\n",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "Instructions",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "text - 15"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let ActiveRules = print Enabled = dynamic({ActiveRules});\r\nActiveRules\r\n| mv-expand Enabled\r\n| count",
              "size": 4,
              "title": "Active Rules",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "greenRed"
                  }
                },
                "showBorder": false
              }
            },
            "customWidth": "20",
            "name": "ActiveRules - Total"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let ActiveRules = print Enabled = dynamic({ActiveRules});\r\nActiveRules\r\n| mv-expand Enabled\r\n| summarize count() by tostring(Enabled)",
              "size": 4,
              "title": "Active Rules - Enabled",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Count",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "greenRed"
                  }
                },
                "showBorder": false
              },
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "false",
                    "color": "red"
                  },
                  {
                    "seriesName": "true",
                    "color": "blue"
                  }
                ]
              }
            },
            "customWidth": "25",
            "name": "ActiveRules - Enabled"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{Workspace:resourcegroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/alertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-10-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.properties.displayName\",\"columnid\":\"RuleName\"},{\"path\":\"$.properties.description\",\"columnid\":\"Description\"},{\"path\":\"$.name\",\"columnid\":\"AlertRuleID\"},{\"path\":\"$.kind\",\"columnid\":\"Kind\"},{\"path\":\"$.properties.productFilter\",\"columnid\":\"ProductName\"},{\"path\":\"$.properties.tactics\",\"columnid\":\"Tactics\"},{\"path\":\"$.properties.enabled\",\"columnid\":\"Status\"},{\"path\":\"$.properties\",\"columnid\":\"prop\"},{\"path\":\"$.properties.tactics\",\"columnid\":\"Tactic\"},{\"path\":\"$.properties.techniques\",\"columnid\":\"Techniques\"}]}}]}",
              "size": 0,
              "noDataMessage": "No analytic rules are defined ",
              "exportedParameters": [
                {
                  "fieldName": "AlertRuleID",
                  "parameterName": "AlertRuleID",
                  "parameterType": 1
                },
                {
                  "fieldName": "ProductName",
                  "parameterName": "ProductName",
                  "parameterType": 1
                },
                {
                  "fieldName": "Tactics",
                  "parameterName": "Tactics",
                  "parameterType": 1
                },
                {
                  "fieldName": "RuleName",
                  "parameterName": "RuleName",
                  "parameterType": 1
                },
                {
                  "fieldName": "Status",
                  "parameterName": "Status",
                  "parameterType": 1
                },
                {
                  "fieldName": "prop",
                  "parameterName": "prop",
                  "parameterType": 1
                },
                {
                  "fieldName": "Kind",
                  "parameterName": "Kind",
                  "parameterType": 1
                },
                {
                  "fieldName": "id",
                  "parameterName": "id",
                  "parameterType": 1
                }
              ],
              "exportToExcelOptions": "all",
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Kind",
                    "formatter": 1
                  },
                  {
                    "columnMatch": "ProductName",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "Tactics",
                    "formatter": 5,
                    "formatOptions": {
                      "customColumnWidthSetting": "0ch"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "1",
                          "representation": "success",
                          "text": "enabled"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "0",
                          "representation": "disabled",
                          "text": "disabled"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "false",
                          "representation": "disabled",
                          "text": "disabled"
                        },
                        {
                          "operator": "Default",
                          "representation": "success",
                          "text": "enabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "prop",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "enabled",
                    "formatter": 3,
                    "formatOptions": {
                      "min": 0,
                      "max": 1,
                      "palette": "redGreen",
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "enabled",
                            "color": "green"
                          }
                        ]
                      }
                    }
                  }
                ],
                "rowLimit": 1000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "RuleName",
                    "sortOrder": 1
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "RuleName",
                    "label": "Rule name"
                  },
                  {
                    "columnId": "AlertRuleID",
                    "label": "Alert rule ID"
                  },
                  {
                    "columnId": "Kind",
                    "label": "Rule type"
                  },
                  {
                    "columnId": "ProductName",
                    "label": "Product name"
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "RuleName",
                  "sortOrder": 1
                }
              ],
              "graphSettings": {
                "type": 0
              },
              "mapSettings": {
                "locInfo": "LatLong"
              }
            },
            "name": "Analytic rules"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "paragraph",
              "links": [
                {
                  "id": "89bacf5f-5a82-4acf-b86c-98f85e8f13c5",
                  "linkTarget": "OpenBlade",
                  "linkLabel": "Open Analytics Blade",
                  "style": "primary",
                  "bladeOpenContext": {
                    "bladeName": "AlertRulesV2Blade",
                    "extensionName": "Microsoft_Azure_Security_Insights"
                  }
                },
                {
                  "id": "521d368e-c46e-41b5-bea0-fd07dc96b511",
                  "linkTarget": "OpenBlade",
                  "linkLabel": "Review MITRE Coverage",
                  "style": "primary",
                  "bladeOpenContext": {
                    "bladeName": "MitrePage.ReactView",
                    "extensionName": "Microsoft_Azure_Security_Insights"
                  }
                }
              ]
            },
            "name": "links - 8"
          },
          {
            "type": 1,
            "content": {
              "json": "------------------------------------------------------"
            },
            "name": "text - 12"
          },
          {
            "type": 1,
            "content": {
              "json": "### Instructions\r\n\r\nThe section below lists the volume of incidents that have been generated and by whom. Use this section to monitor SOC operations and culprits for alerts/incidents.\r\n\r\n",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "Instructions",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "text - 16"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityAlert\r\n| extend Source = case(ProviderName has 'ASI Scheduled Alerts', 'Microsoft Sentinel',\r\n                    ProviderName has 'MDATP', 'Defender for Endpoint',\r\n                    ProviderName has 'Azure Security Center', 'Defender for Cloud',\r\n                    ProviderName has 'Azure Advanced Threat Protection', 'Defender for Identity',\r\n                    ProviderName has 'OATP', 'Defender for Office',\r\n                    ProviderName has 'MCAS', 'Defender for Cloud Apps',\r\n                    ProviderName)\r\n| summarize count() by Source, bin(TimeGenerated, 1d)",
              "size": 0,
              "title": "Incident Frequency by Product",
              "timeContextFromParameter": "TimeRange",
              "timeBrushParameterName": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "linechart"
            },
            "name": "query - 5"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityAlert\r\n| extend Source = case(ProviderName has 'ASI Scheduled Alerts', 'Microsoft Sentinel',\r\n                    ProviderName has 'MDATP', 'Defender for Endpoint',\r\n                    ProviderName has 'Azure Security Center', 'Defender for Cloud',\r\n                    ProviderName has 'Azure Advanced Threat Protection', 'Defender for Identity',\r\n                    ProviderName has 'OATP', 'Defender for Office',\r\n                    ProviderName has 'MCAS', 'Defender for Cloud Apps',\r\n                    ProviderName)\r\n| summarize Count = count() by DisplayName, Source\r\n| order by Count desc",
              "size": 0,
              "title": "Number of Alerts Raised by Product",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Count",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "coldHot"
                    }
                  },
                  {
                    "columnMatch": "Alert Source",
                    "formatter": 1
                  }
                ],
                "rowLimit": 500,
                "filter": true
              }
            },
            "customWidth": "40",
            "name": "query - 4"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityIncident\n| where Status == 'Closed'\n| extend Owner = todynamic(Owner.assignedTo) \n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \n| extend feedback =strcat(Classification,\" \",ClassificationReason)\n| summarize dcount(IncidentNumber) by feedback\n",
              "size": 1,
              "title": "Incidents Closed with Classification",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart"
            },
            "customWidth": "28",
            "name": "Incidents by classification - headline"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityIncident \n| summarize arg_max(TimeGenerated,Status, Severity, Owner, AdditionalData) by IncidentNumber\n| extend Owner = todynamic(Owner.assignedTo) \n| extend Product = todynamic((parse_json(tostring(AdditionalData.alertProductNames))[0])) \n| summarize dcount(IncidentNumber) by Severity",
              "size": 1,
              "title": "Incidents created by severity",
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "piechart",
              "tileSettings": {
                "showBorder": false,
                "titleContent": {
                  "columnMatch": "Classification",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "dcount_IncidentNumber",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 17,
                    "options": {
                      "maximumSignificantDigits": 3,
                      "maximumFractionDigits": 2
                    }
                  }
                }
              },
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "Informational",
                    "color": "gray"
                  },
                  {
                    "seriesName": "Low",
                    "color": "yellow"
                  },
                  {
                    "seriesName": "Medium",
                    "color": "orange"
                  },
                  {
                    "seriesName": "High",
                    "color": "red"
                  }
                ]
              }
            },
            "customWidth": "28",
            "name": "By severity"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let SecurityProducts = datatable(ProviderName:string, Product:string, Portal:string)\r\n[\r\n    \"ASI Scheduled Alerts\", \"Microsoft Sentinel\", \"https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel\",\r\n    \"MCAS\", \"Microsoft Defender for Cloud Apps\", \"https://portal.cloudappsecurity.com/#/policy\",\r\n    \"MDATP\", \"Microsoft Defender for Endpoint\", \"https://security.microsoft.com/alertpolicies\",\r\n    \"Azure Security Center\", \"Microsoft Defender for Cloud\", \"https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/7\",\r\n    \"Detection-WarmPathV2\", \"Microsoft Defender for Cloud\", \"https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/7\",\r\n    \"MicrosoftThreatProtection\", \"Microsoft 365 Defender\", \"https://security.microsoft.com/alertpolicies\",\r\n    \"IPC\", \"Azure Active Directory Identity Protection\", \"https://portal.azure.com/#blade/Microsoft_AAD_IAM/IdentityProtectionMenuBlade/UsersAtRiskAlerts\",\r\n   \"Detection-Fusion\", \"Machine Learning Fusion Alert\", \"https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel\",\r\n    \"Sentinel Fusion\", \"Machine Learning Fusion Alert\", \"https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel\",\r\n    \"Azure Advanced Threat Protection\", \"Microsoft Defender for Identity\", \"https://portal.atp.azure.com/\",\r\n    \"Threat Intelligence Alerts\", \"Threat Intelligence\", \"https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/microsoft.securityinsightsarg%2Fsentinel\",\r\n    \"IoTSecurity\", \"Microsoft Defender for IoT\", \"https://portal.azure.com/#blade/Microsoft_Azure_IoT_Defender/IoTDefenderDashboard/Alerts\",\r\n    \"MSTIC\", \"Microsoft Intelligent Security Graph\", \"https://portal.azure.com/#blade/HubsExtension/ArgQueryBlade\",\r\n    \"AntimalwarePublisher\", \"Microsoft Anti-Malware\", \"https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/7\",\r\n    \"OATP\", \"Microsoft Defender for Office 365\", \"https://security.microsoft.com/alertpolicies\",\r\n    \"AdaptiveNetworkHardenings\", \"Microsoft Defender for Cloud\", \"https://portal.azure.com/#blade/Microsoft_Azure_Security/GenericRecommendationDetailsBlade/assessmentKey/f9f0eed0-f143-47bf-b856-671ea2eeed62\",\r\n    \"StorageThreatDetection\", \"Azure Defender for Storage\", \"https://portal.azure.com/#blade/Microsoft_Azure_Security/SecurityMenuBlade/7\",\r\n    \"CloudNetworkSecurity\", \"Azure Network Security\", \"https://portal.azure.com/#blade/Microsoft_Azure_Network/NetworkWatcherMenuBlade/overview\",\r\n    \"SQLThreatDetection\", \"Azure Defender for SQL\", \"https://portal.azure.com/#blade/Microsoft_Azure_Security/SqlVaServersRecommendationDetailsBlade/assessmentKey/82e20e14-edc5-4373-bfc4-f13121257c37\"\r\n];\r\nSecurityIncident\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| where Status==\"Closed\"\r\n| mv-expand AlertIds\r\n| extend SystemAlertId=strcat(AlertIds)\r\n| join kind=inner (SecurityAlert | extend SystemAlertId=strcat(SystemAlertId)) on SystemAlertId\r\n| summarize\r\n    TruePositive‚ÄØ=‚ÄØcountif(Classification == \"TruePositive\"),\r\n    BenignPositive‚ÄØ=‚ÄØcountif(Classification == \"BenignPositive\"),\r\n    FalsePositive‚ÄØ=‚ÄØcountif(Classification == \"FalsePositive\"),\r\n    Undetermined‚ÄØ=‚ÄØcountif(Classification == \"Undetermined\"),\r\n    Total‚ÄØ=‚ÄØcountif(Classification == \"TruePositive\" or Classification == \"BenignPositive\" or Classification == \"FalsePositive\") by AlertName, ProviderName1\r\n| extend EfficiencyRating‚ÄØ= (TruePositive / todouble(Total)) * 100\r\n| join kind=inner(SecurityProducts) on $left.ProviderName1 == $right.ProviderName\r\n| project AlertName, EfficiencyRating, Portal, Product, Total, TruePositive, BenignPositive, FalsePositive, Undetermined\r\n| sort by EfficiencyRating, Total desc\r\n",
              "size": 0,
              "showAnalytics": true,
              "title": "Security Alert Efficiency",
              "noDataMessage": "No Alerts Observed Within These Thresholds",
              "timeContextFromParameter": "TimeRange",
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "AlertName",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "representation": "Alert",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "EfficiencyRating",
                    "formatter": 4,
                    "formatOptions": {
                      "palette": "redGreen"
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "maximumFractionDigits": 0
                      }
                    }
                  },
                  {
                    "columnMatch": "Portal",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "Tune Alert >>"
                    }
                  },
                  {
                    "columnMatch": "Product",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "Default",
                          "representation": "Defense Evasion",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Total",
                    "formatter": 22,
                    "formatOptions": {
                      "compositeBarSettings": {
                        "labelText": "",
                        "columnSettings": [
                          {
                            "columnName": "TruePositive",
                            "color": "green"
                          },
                          {
                            "columnName": "BenignPositive",
                            "color": "orange"
                          },
                          {
                            "columnName": "FalsePositive",
                            "color": "redBright"
                          }
                        ]
                      }
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_bar_EfficiencyRating_1",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_bar_EfficiencyRating_1",
                  "sortOrder": 1
                }
              ]
            },
            "name": "query - 3"
          },
          {
            "type": 1,
            "content": {
              "json": "----------------------------------------------------------------------------------------------------\r\n\r\n# Analytic Rule Health"
            },
            "name": "text - 6"
          },
          {
            "type": 1,
            "content": {
              "json": "### Instructions\r\n\r\nThis graph lists the number of:\r\n- Runs for scheduled rules\r\n- Runs for NRT rules\r\n- Failures for rules\r\n\r\nThis information can be used to track:\r\n- How many times rules are running\r\n- How many times rules are failing\r\n\r\nDetails around the rules can be used in correlation with the volume of alerts/incidents being generated by Microsoft Sentinel. If the volume is too much, the logs and graph can help pinpoint when it's occurring and which rules are responsible for generating the incidents.",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "Instructions",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "text - 17"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SentinelHealth\r\n| where SentinelResourceType has 'analytics rule'\r\n| summarize count() by OperationName, bin (TimeGenerated, 1d)",
              "size": 0,
              "title": "Analytic Rule Triggering and Failures {TimeRange}",
              "timeContextFromParameter": "TimeRange",
              "timeBrushParameterName": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "visualization": "linechart"
            },
            "name": "query - 7"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SentinelHealth\r\n| where SentinelResourceType has 'analytics rule'\r\n| project TimeGenerated, OperationName, Status, SentinelResourceName, Description, Reason, SentinelResourceKind\r\n| order by TimeGenerated desc",
              "size": 0,
              "title": "Analytics Health Logs",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "rowLimit": 1000,
                "filter": true
              }
            },
            "name": "query - 18"
          },
          {
            "type": 1,
            "content": {
              "json": "---\r\n\r\n### üìã Analytics Rules Inventory - Source vs Target\r\n\r\nDetailed comparison of analytics rules between source and target workspaces for migration tracking.",
              "style": "info"
            },
            "name": "analytics-inventory-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{SourceWorkspace}/providers/Microsoft.SecurityInsights/alertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2023-02-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.properties.displayName\",\"columnid\":\"Rule Name\"},{\"path\":\"$.kind\",\"columnid\":\"Type\"},{\"path\":\"$.properties.enabled\",\"columnid\":\"Enabled\"},{\"path\":\"$.properties.severity\",\"columnid\":\"Severity\"}]}}]}",
              "size": 0,
              "title": "üìä Source Analytics Rules - {SourceWorkspace:name}",
              "exportToExcelOptions": "all",
              "queryType": 12,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Enabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "success",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "representation": "disabled",
                          "text": "Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "3",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "1",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "representation": "info",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_group_Severity_1",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_group_Severity_1",
                  "sortOrder": 1
                }
              ]
            },
            "customWidth": "50",
            "name": "ar-source-rules-list"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{Workspace}/providers/Microsoft.SecurityInsights/alertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2023-02-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.properties.displayName\",\"columnid\":\"Rule Name\"},{\"path\":\"$.kind\",\"columnid\":\"Type\"},{\"path\":\"$.properties.enabled\",\"columnid\":\"Enabled\"},{\"path\":\"$.properties.severity\",\"columnid\":\"Severity\"}]}}]}",
              "size": 0,
              "title": "üéØ Target Analytics Rules - {Workspace:name}",
              "exportToExcelOptions": "all",
              "queryType": 12,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Enabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "success",
                          "text": "Enabled"
                        },
                        {
                          "operator": "Default",
                          "representation": "disabled",
                          "text": "Disabled"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "3",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "1",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "representation": "info",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "$gen_group_Severity_1",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "$gen_group_Severity_1",
                  "sortOrder": 1
                }
              ]
            },
            "customWidth": "50",
            "name": "ar-target-rules-list"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "AR"
      },
      "name": "AR"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "## Watchlists Migration\r\n\r\nWatchlists are lookup tables that you can use to enrich alerts and enable hunting scenarios. They contain reference data like IP addresses, hostnames, users, or other data sources.\r\n\r\n### Migration Strategy:\r\n\r\n1. **Inventory Source Watchlists** - Identify all watchlists in source workspace\r\n2. **Export Data** - Download watchlist data as CSV files\r\n3. **Create in Target** - Recreate watchlist schemas in target workspace  \r\n4. **Import Data** - Upload CSV data to target watchlists\r\n5. **Update References** - Update analytics rules and hunting queries that reference watchlists\r\n6. **Validate** - Verify watchlist queries work correctly in target\r\n\r\n### Key Considerations:\r\n\r\n- **SearchKey Field**: Ensure SearchKey is defined correctly for lookups\r\n- **Size Limits**: Watchlists support up to 10 million rows\r\n- **Update Frequency**: Consider automation for frequently updated watchlists\r\n- **Dependencies**: Analytics rules and hunting queries may depend on watchlists\r\n- **API/ARM Templates**: Use API or ARM templates for programmatic migration\r\n\r\n**Note**: Watchlists can be migrated using ARM templates, PowerShell, or manually via the portal.",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "MigrationTips",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "watchlist-migration-guidance"
          },
          {
            "type": 1,
            "content": {
              "json": "---\r\n\r\n### üìã Watchlists Inventory - Source vs Target\r\n\r\nComparison of watchlists between source and target workspaces for migration tracking.",
              "style": "info"
            },
            "name": "watchlists-inventory-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{SourceWorkspace}/providers/Microsoft.SecurityInsights/watchlists\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2023-02-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.properties.displayName\",\"columnid\":\"WatchlistName\"},{\"path\":\"$.properties.alias\",\"columnid\":\"Alias\"},{\"path\":\"$.properties.itemsSearchKey\",\"columnid\":\"SearchKey\"},{\"path\":\"$.properties.numberOfLinesToSkip\",\"columnid\":\"SkipLines\"},{\"path\":\"$.properties.provider\",\"columnid\":\"Provider\"}]}}]}",
              "size": 0,
              "title": "üìä Source Watchlists - {SourceWorkspace:name}",
              "exportToExcelOptions": "all",
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "SkipLines",
                    "formatter": 1
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "WatchlistName",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "WatchlistName",
                  "sortOrder": 1
                }
              ]
            },
            "customWidth": "50",
            "name": "wl-source-watchlists-list"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{Workspace}/providers/Microsoft.SecurityInsights/watchlists\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2023-02-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.properties.displayName\",\"columnid\":\"WatchlistName\"},{\"path\":\"$.properties.alias\",\"columnid\":\"Alias\"},{\"path\":\"$.properties.itemsSearchKey\",\"columnid\":\"SearchKey\"},{\"path\":\"$.properties.numberOfLinesToSkip\",\"columnid\":\"SkipLines\"},{\"path\":\"$.properties.provider\",\"columnid\":\"Provider\"}]}}]}",
              "size": 0,
              "title": "üéØ Target Watchlists - {Workspace:name}",
              "exportToExcelOptions": "all",
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "SkipLines",
                    "formatter": 1
                  }
                ],
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "WatchlistName",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "WatchlistName",
                  "sortOrder": 1
                }
              ]
            },
            "customWidth": "50",
            "name": "wl-target-watchlists-list"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "paragraph",
              "links": [
                {
                  "id": "wl-source-blade",
                  "linkTarget": "OpenBlade",
                  "linkLabel": "Open Source Watchlists",
                  "style": "primary",
                  "bladeOpenContext": {
                    "bladeName": "WatchlistsBlade",
                    "extensionName": "Microsoft_Azure_Security_Insights",
                    "bladeParameters": [
                      {
                        "name": "id",
                        "source": "parameter",
                        "value": "SourceWorkspace"
                      }
                    ]
                  }
                },
                {
                  "id": "wl-target-blade",
                  "linkTarget": "OpenBlade",
                  "linkLabel": "Open Target Watchlists",
                  "style": "primary",
                  "bladeOpenContext": {
                    "bladeName": "WatchlistsBlade",
                    "extensionName": "Microsoft_Azure_Security_Insights",
                    "bladeParameters": [
                      {
                        "name": "id",
                        "source": "parameter",
                        "value": "Workspace"
                      }
                    ]
                  }
                }
              ]
            },
            "name": "watchlist-links"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "WL"
      },
      "name": "Watchlists"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "225f3627-ce8a-41fd-ba3e-727f7034f73f",
                  "version": "KqlParameterItem/1.0",
                  "name": "View",
                  "type": 10,
                  "isRequired": true,
                  "typeSettings": {
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    {\"value\": \"Monitor\", \"label\": \"Monitor\", \"selected\":true},\r\n    {\"value\": \"Configure\", \"label\": \"Configure\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "above",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 8"
          },
          {
            "type": 1,
            "content": {
              "json": "### Instructions\r\n\r\n1. Click on one of the workbook names in the list below. </br>\r\n2. The id will be fetched for opening. </br>\r\n3. Click the 'Open Selected Workbook' button to open the workbook of interest.",
              "style": "info"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "View",
                "comparison": "isEqualTo",
                "value": "Monitor"
              },
              {
                "parameterName": "Instructions",
                "comparison": "isEqualTo",
                "value": "Yes"
              }
            ],
            "name": "text - 20"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| project Workbook, id\r\n| order by Workbook asc",
              "size": 0,
              "title": "Current Deployed Workbooks",
              "exportFieldName": "id",
              "exportParameterName": "id",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "id",
                    "formatter": 5
                  }
                ],
                "rowLimit": 1000,
                "filter": true
              }
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Monitor"
            },
            "name": "query - 9"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| summarize count()",
              "size": 0,
              "title": "Number of Workbooks Deployed",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "card",
              "textSettings": {
                "style": "bignumber"
              }
            },
            "customWidth": "30",
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Monitor"
            },
            "name": "query - 10"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "525e9ce8-b38b-442d-9f59-92211466056d",
                  "version": "KqlParameterItem/1.0",
                  "name": "WorkbookID",
                  "type": 1,
                  "query": "let id = dynamic('{id}');\r\nprint id",
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 0,
                  "resourceType": "microsoft.operationalinsights/workspaces"
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "customWidth": "10",
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Monitor"
            },
            "name": "parameters - 12"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "list",
              "links": [
                {
                  "id": "73ab1852-68e7-45c5-89c9-43fb693758e7",
                  "cellValue": "{WorkbookID}",
                  "linkTarget": "Resource",
                  "linkLabel": "Open Selected Workbook",
                  "subTarget": "Workbook",
                  "style": "primary",
                  "linkIsContextBlade": true
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Monitor"
            },
            "name": "links - 13"
          },
          {
            "type": 1,
            "content": {
              "json": "### Please note that any deployment performed in this section will apply to the current Microsoft Sentinel instance, it will not apply to a different instance or workspace chosen above.",
              "style": "warning"
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "text - 12"
          },
          {
            "type": 1,
            "content": {
              "json": "### Workbooks Migration\r\n\r\n*General Tips and Guidance*\r\n<p>\r\n- Inventory all workbooks in the source workspace </br>\r\n- Identify critical dashboards and workbooks for priority migration </br>\r\n- Export workbooks as ARM templates or JSON from source workspace </br>\r\n- Review workbook data sources and update workspace references </br>\r\n- Test workbooks with target workspace data before full deployment </br>\r\n</p>\r\n\r\n*Migration Approaches* \r\n<p>\r\n- **ARM Template Export**: Export workbooks from source workspace and import to target </br>\r\n- **Gallery Templates**: Check if equivalent workbooks exist in the built-in gallery </br>\r\n- **Content Hub**: Review Content Hub for updated versions of existing workbooks </br>\r\n- **Custom Workbooks**: Manually recreate custom workbooks, updating data references </br>\r\n</p>\r\n\r\n[Intro to KQL](https://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/get-hands-on-kql-practice-with-this-microsoft-sentinel-workbook/ba-p/3055600) </br>\r\n[Advanced KQL Framework](https://techcommunity.microsoft.com/t5/microsoft-sentinel-blog/advanced-kql-framework-workbook-empowering-you-to-become-kql/ba-p/3033766) </br>",
              "style": "info"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "MigrationTips",
                "comparison": "isEqualTo",
                "value": "Yes"
              },
              {
                "parameterName": "View",
                "comparison": "isEqualTo",
                "value": "Configure"
              }
            ],
            "name": "text - 10"
          },
          {
            "type": 1,
            "content": {
              "json": "### Instructions\r\n\r\nUse this tab to deploy and open key workbooks of interest. Make sure to switch to the 'Monitor' view to see all of the workbooks that are in the environment and to open them. </br>\r\n\r\nTo deploy:\r\n1. Click on the buttons below to open the workbook gallery that is filtered.\r\n2. Click on the workbook.\r\n3. Click save.\r\n4. Return to this workbook.\r\n5. If looking to jump right into the workbook that was deployed, click the 'open' button.\r\n\r\nIf there are any workbooks of interest that are not listed as a button, please use the buttons to open the workbook gallery or Content Hub to deploy the items of interest.",
              "style": "info"
            },
            "conditionalVisibilities": [
              {
                "parameterName": "Instructions",
                "comparison": "isEqualTo",
                "value": "Yes"
              },
              {
                "parameterName": "View",
                "comparison": "isEqualTo",
                "value": "Configure"
              }
            ],
            "name": "text - 18"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Office 365",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "47b9e714-fca9-4e61-8858-dc97f1ab69c7",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Exchange Online Workbook",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Exchange Online"
                            }
                          ]
                        }
                      },
                      {
                        "id": "c7a908fa-8b4a-4cd3-88b3-98166607a58a",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Sharepoint & OneDrive Workbook",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "SharePoint & OneDrive"
                            }
                          ]
                        }
                      },
                      {
                        "id": "f52ad648-56cb-48c9-aaf1-d59266a4c088",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy O365 Workbook",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Office 365"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "25",
                  "name": "links - 0"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "ac9e37bd-ef74-4c4a-a677-d3327a0fb599",
                        "version": "KqlParameterItem/1.0",
                        "name": "ExchangeWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Exchange Online'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "6b111634-564e-4198-b5cf-c3710380f414",
                        "version": "KqlParameterItem/1.0",
                        "name": "SharePointWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'SharePoint & OneDrive'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "32458f16-ace3-4b3b-ba22-8bdad066abd2",
                        "version": "KqlParameterItem/1.0",
                        "name": "O365WB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Office 365'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "customWidth": "5",
                  "name": "parameters - 2"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "858c6ec5-5cc1-49f0-b2df-67b5dbb56bd3",
                        "cellValue": "{ExchangeWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Exchange Online Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "ExchangeWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "ExchangeWB",
                          "templateIdSource": "parameter",
                          "templateId": "ExchangeWB",
                          "typeSource": "parameter",
                          "type": "ExchangeWB",
                          "gallerySource": "workbook",
                          "locationSource": "default",
                          "passSpecificParams": true,
                          "templateParameters": [
                            {
                              "name": "Log Analytics workspace",
                              "source": "static",
                              "value": "Use Default Resources"
                            }
                          ]
                        }
                      },
                      {
                        "id": "5e8117e6-c16c-4817-ba0d-1b686e835c69",
                        "cellValue": "{SharePointWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open SharePoint and OneDrive Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "SharePointWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "SharePointWB",
                          "templateIdSource": "parameter",
                          "templateId": "SharePointWB",
                          "typeSource": "parameter",
                          "type": "SharePointWB",
                          "gallerySource": "workbook",
                          "locationSource": "default",
                          "passSpecificParams": true,
                          "templateParameters": [
                            {
                              "name": "Workspace",
                              "source": "parameter",
                              "value": "Workspace"
                            }
                          ]
                        }
                      },
                      {
                        "id": "a017fbcb-6715-4529-aec9-45a11952b434",
                        "cellValue": "{O365WB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open O365 Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "O365WB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "O365WB",
                          "templateIdSource": "parameter",
                          "templateId": "O365WB",
                          "typeSource": "parameter",
                          "type": "O365WB",
                          "gallerySource": "workbook",
                          "locationSource": "default",
                          "passSpecificParams": true,
                          "templateParameters": [
                            {
                              "name": "Workspace",
                              "source": "parameter",
                              "value": "Workspace"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "30",
                  "name": "links - 1"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "O365"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "M365 Defender",
              "expandable": true,
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "7e266e7b-0456-427b-8965-f16940b195b0",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Investigation Insights",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Investigation Insights"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "25",
                  "name": "links - 0"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "288b926d-0c74-42b9-8b2c-61f1a0ad1648",
                        "version": "KqlParameterItem/1.0",
                        "name": "IIWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Investigation Insights'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "customWidth": "5",
                  "name": "parameters - 1"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "c5eebe8a-7310-4570-b94b-08668a85fea7",
                        "cellValue": "IIWB",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Investigation Insights",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "IIWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "IIWB",
                          "templateIdSource": "parameter",
                          "templateId": "IIWB",
                          "typeSource": "parameter",
                          "type": "IIWB",
                          "gallerySource": "workbook",
                          "locationSource": "default"
                        }
                      }
                    ]
                  },
                  "customWidth": "30",
                  "name": "links - 2"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "M365D"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Defender for Cloud",
              "expandable": true,
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "8a1957e6-6731-4df6-970e-2e482b91f4d6",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Compliance and Protection",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "ASC Compliance and Protection"
                            }
                          ]
                        }
                      },
                      {
                        "id": "5d5cf052-f1d1-4e0c-a3c1-a497e39c3d88",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy AKS Security Workbook",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Azure Kubernetes Service (AKS) Security"
                            }
                          ]
                        }
                      },
                      {
                        "id": "631b3da7-7325-4377-9cd9-7c57bbd1f097",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Azure Key Vault Security Workbook",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Azure Key Vault Security"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "25",
                  "name": "links - 0"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "c78ad33c-49c4-47bc-959d-d61f8edc55b5",
                        "version": "KqlParameterItem/1.0",
                        "name": "CnPWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Compliance and Protection'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "6a4e117d-513a-4f78-995c-700ec94af52e",
                        "version": "KqlParameterItem/1.0",
                        "name": "AKSWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Azure Kubernetes Service'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "052e9502-4e27-4fda-b381-bd375bd7680c",
                        "version": "KqlParameterItem/1.0",
                        "name": "AKVWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Azure Key Vault'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "customWidth": "5",
                  "name": "parameters - 1"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "da2c5acb-c92e-4df9-ae28-64bfe5cc2cb9",
                        "cellValue": "{CnPWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Compliance and Protection",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "CnPWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "CnPWB",
                          "templateIdSource": "parameter",
                          "templateId": "CnPWB",
                          "typeSource": "parameter",
                          "type": "CnPWB",
                          "gallerySource": "workbook",
                          "locationSource": "default"
                        }
                      },
                      {
                        "id": "ab65aed6-e6a9-48fe-ae7c-ecd7a0bb9307",
                        "cellValue": "{AKSWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open AKS Security Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "AKSWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "AKSWB",
                          "templateIdSource": "parameter",
                          "templateId": "AKSWB",
                          "typeSource": "parameter",
                          "type": "AKSWB",
                          "gallerySource": "workbook",
                          "locationSource": "default",
                          "passSpecificParams": true,
                          "templateParameters": [
                            {
                              "name": "Subscription",
                              "source": "parameter",
                              "value": "Subscription"
                            }
                          ]
                        }
                      },
                      {
                        "id": "843a6432-8204-461a-990f-46aa44849b11",
                        "cellValue": "{AKVWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Azure Key Vault Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "AKVWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "AKVWB",
                          "templateIdSource": "parameter",
                          "templateId": "AKVWB",
                          "typeSource": "parameter",
                          "type": "AKVWB",
                          "gallerySource": "workbook",
                          "locationSource": "default",
                          "passSpecificParams": true,
                          "templateParameters": [
                            {
                              "name": "Workspace",
                              "source": "parameter",
                              "value": "Workspace"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "30",
                  "name": "links - 2"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "group - 3"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Azure Activity",
              "expandable": true,
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "debce5b9-cc9b-4df8-8713-9e62f7bcfeec",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Azure Activity Workbook",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Azure Activity"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "25",
                  "name": "links - 0"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "462043cf-5804-4fc9-b6d9-f454de2d7ed9",
                        "version": "KqlParameterItem/1.0",
                        "name": "AAWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Azure Activity'\r\n| project id\r\n| take 1\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "customWidth": "5",
                  "name": "parameters - 1"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "f0a589fd-d365-4e67-b8de-94ea6492fbbc",
                        "cellValue": "{AAWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Azure Activity Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "AAWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "AAWB",
                          "templateIdSource": "parameter",
                          "templateId": "AAWB",
                          "typeSource": "parameter",
                          "type": "AAWB",
                          "gallerySource": "workbook",
                          "locationSource": "default",
                          "passSpecificParams": true,
                          "templateParameters": [
                            {
                              "name": "Resource Group",
                              "source": "workbook",
                              "value": "{Workspace:resourcegroup}"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "30",
                  "name": "links - 2"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "group - 4"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Microsoft Entra ID",
              "expandable": true,
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "b4469f44-ad11-4e8c-bb81-cd138bb30b2a",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Azure AD Sign-in Logs Workbook",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Azure AD Sign-in logs"
                            }
                          ]
                        }
                      },
                      {
                        "id": "a4b076fe-a46e-4f93-86f7-0090fdf2fb9b",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Azure AD Audit Logs Workbook",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Azure AD Audit logs"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "25",
                  "name": "links - 0"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "cc63e67f-ea85-49a6-9d95-48ce801d9073",
                        "version": "KqlParameterItem/1.0",
                        "name": "AADSWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Sign-in logs'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "cb98929a-5002-4cb6-8a54-ca868b900bf1",
                        "version": "KqlParameterItem/1.0",
                        "name": "AADAWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Audit Logs'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "customWidth": "5",
                  "name": "parameters - 1"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "ee4d8d9d-20fe-4f6c-bca1-19491c00c23f",
                        "cellValue": "{AADSWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Entra ID Sign-in Logs Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "AADSWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "AADSWB",
                          "templateIdSource": "parameter",
                          "templateId": "AADSWB",
                          "typeSource": "parameter",
                          "type": "AADSWB",
                          "gallerySource": "workbook",
                          "locationSource": "default"
                        }
                      },
                      {
                        "id": "ada780e3-4682-4376-916b-adef870fc196",
                        "cellValue": "{AADAWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Entra ID Audit Logs Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "AADAWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "AADAWB",
                          "templateIdSource": "parameter",
                          "templateId": "AADAWB",
                          "typeSource": "parameter",
                          "type": "AADAWB",
                          "gallerySource": "workbook",
                          "locationSource": "default"
                        }
                      }
                    ]
                  },
                  "customWidth": "30",
                  "name": "links - 2"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "group - 5"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Security Events",
              "expandable": true,
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "50207b45-50b9-46de-abfe-9ae6a4bd784f",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Identity and Access Workbook",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Identity & Access"
                            }
                          ]
                        }
                      },
                      {
                        "id": "47c8f4a6-fc0e-4e7e-90cc-769683090c58",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Insecure Protocols Workbook",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Insecure Protocols"
                            }
                          ]
                        }
                      },
                      {
                        "id": "743c0e13-3704-404f-a4de-cabe6ee485bd",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Windows Firewall Workbook",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Windows Firewall"
                            }
                          ]
                        }
                      },
                      {
                        "id": "32f966c6-193a-40d7-ae21-3e532d3d7a12",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Event Analyzer Workbook",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Event Analyzer"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "25",
                  "name": "links - 0"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "d12df23b-9855-49d3-bf9b-3c1a1a212622",
                        "version": "KqlParameterItem/1.0",
                        "name": "IAWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Identity & Access'\r\n| project id\r\n| take 1\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "5f3a41cd-909d-401d-807c-15e0a559a04e",
                        "version": "KqlParameterItem/1.0",
                        "name": "IPWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Insecure Protocols'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "6945e225-45fb-4510-9ed3-3f69cbe31014",
                        "version": "KqlParameterItem/1.0",
                        "name": "WFWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Windows Firewall'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "2a8d85fd-12ac-4451-a602-d2f0db24e153",
                        "version": "KqlParameterItem/1.0",
                        "name": "EAWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Event Analyzer'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "customWidth": "5",
                  "name": "parameters - 1"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "be0a8548-39fb-40e6-94f5-0d341c122998",
                        "cellValue": "{IAWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Identity and Access Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "IAWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "IAWB",
                          "templateIdSource": "parameter",
                          "templateId": "IAWB",
                          "typeSource": "parameter",
                          "type": "IAWB",
                          "gallerySource": "workbook",
                          "locationSource": "default",
                          "passSpecificParams": true,
                          "templateParameters": [
                            {
                              "name": "Workspace",
                              "source": "parameter",
                              "value": "Workspace"
                            }
                          ]
                        }
                      },
                      {
                        "id": "f92f796d-78eb-4365-8435-e41d71a79f7f",
                        "cellValue": "{IPWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Insecure Protocols Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "IPWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "IPWB",
                          "templateIdSource": "parameter",
                          "templateId": "IPWB",
                          "typeSource": "parameter",
                          "type": "IPWB",
                          "gallerySource": "workbook",
                          "locationSource": "default"
                        }
                      },
                      {
                        "id": "9a4fdfcb-05f6-4e1a-a46c-2939354972ab",
                        "cellValue": "{WFWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Windows Firewall Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "WFWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "WFWB",
                          "templateIdSource": "parameter",
                          "templateId": "WFWB",
                          "typeSource": "parameter",
                          "type": "WFWB",
                          "gallerySource": "workbook",
                          "locationSource": "default"
                        }
                      },
                      {
                        "id": "7040815f-dfea-44e6-9fee-9a0d01530362",
                        "cellValue": "{EAWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Event Analyzer Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "EAWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "EAWB",
                          "templateIdSource": "parameter",
                          "templateId": "EAWB",
                          "typeSource": "parameter",
                          "type": "EAWB",
                          "gallerySource": "workbook",
                          "locationSource": "default"
                        }
                      }
                    ]
                  },
                  "customWidth": "30",
                  "name": "links - 2"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "group - 6"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Recommended Workbooks",
              "expandable": true,
              "expanded": true,
              "items": [
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "f1315142-2222-4a73-9c18-2409ff72d7b3",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Security Operations Efficiency",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Security Operations Efficiency"
                            }
                          ]
                        }
                      },
                      {
                        "id": "cec58a12-3603-4428-9b35-72d4430d6cef",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Workspace Usage Report",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Workspace Usage Report"
                            }
                          ]
                        }
                      },
                      {
                        "id": "10749f0e-e359-413e-a69b-e9263d05199c",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Data Collection Health Monitoring",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Data Collection Health Monitoring"
                            }
                          ]
                        }
                      },
                      {
                        "id": "c5b13ff1-2f91-426b-8d10-e82a40d740cd",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Microsoft Sentinel Cost Workbook",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Microsoft Sentinel Cost"
                            }
                          ]
                        }
                      },
                      {
                        "id": "49fd8232-47c0-45c3-90b5-ed71755b5a5c",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Intro to KQL",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Intro to KQL"
                            }
                          ]
                        }
                      },
                      {
                        "id": "8bc0edac-b0c0-4157-9e94-2cd3fa63be9c",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Advanced KQL",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "Advanced KQL for Microsoft Sentinel"
                            }
                          ]
                        }
                      },
                      {
                        "id": "b26e19db-5dc1-4890-920e-b36bc961c4f8",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy SOC Process Framework",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "WorkbooksBlade",
                          "extensionName": "Microsoft_Azure_Security_Insights",
                          "bladeParameters": [
                            {
                              "name": "itemNameToOpen",
                              "source": "static",
                              "value": "SOC Process Framework"
                            }
                          ]
                        }
                      },
                      {
                        "id": "382e867e-5147-4ca0-ac99-fb7b061b1efb",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy CyberSecurity Maturity Model",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "ContentHub.ReactView",
                          "extensionName": "Microsoft_Azure_SentinelUS",
                          "bladeParameters": [
                            {
                              "name": "subscriptionId",
                              "source": "static",
                              "value": "{Subscription:id}"
                            },
                            {
                              "name": "resourceGroup",
                              "source": "static",
                              "value": "{Workspace:resourcegroup}"
                            },
                            {
                              "name": "workspaceName",
                              "source": "static",
                              "value": "{Workspace:name}"
                            }
                          ]
                        }
                      },
                      {
                        "id": "302c071b-258c-4e27-91ee-0f4386fa36e3",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Zero Trust Solution",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "ContentHub.ReactView",
                          "extensionName": "Microsoft_Azure_SentinelUS",
                          "bladeParameters": [
                            {
                              "name": "subscriptionId",
                              "source": "static",
                              "value": "{Subscription:id}"
                            },
                            {
                              "name": "resourceGroup",
                              "source": "static",
                              "value": "{Workspace:resourcegroup}"
                            },
                            {
                              "name": "workspaceName",
                              "source": "static",
                              "value": "{Workspace:name}"
                            }
                          ]
                        }
                      },
                      {
                        "id": "6439828d-b6e9-4c59-bc91-6cfe4612475c",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Deploy Insider Risk Management",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "ContentHub.ReactView",
                          "extensionName": "Microsoft_Azure_SentinelUS",
                          "bladeParameters": [
                            {
                              "name": "subscriptionId",
                              "source": "static",
                              "value": "{Subscription:id}"
                            },
                            {
                              "name": "resourceGroup",
                              "source": "static",
                              "value": "{Workspace:resourcegroup}"
                            },
                            {
                              "name": "workspaceName",
                              "source": "static",
                              "value": "{Workspace:name}"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  "customWidth": "25",
                  "name": "links - 0"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "c5079bc2-933f-49da-97f5-0a55462924c6",
                        "version": "KqlParameterItem/1.0",
                        "name": "SOCWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Security Operations Efficiency'\r\n| project id\r\n| take 1\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "cacce9d4-0b2a-473c-ba0d-ebca1e581c4e",
                        "version": "KqlParameterItem/1.0",
                        "name": "WUWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Workspace Usage Report'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "4a7aac98-d643-4d1c-8eb6-3256dd10c394",
                        "version": "KqlParameterItem/1.0",
                        "name": "MSCWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Microsoft Sentinel Cost'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "62f2d4bd-d98d-4a4a-956a-2881f1328076",
                        "version": "KqlParameterItem/1.0",
                        "name": "DCHWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Data collection health monitoring'\r\n| project id\r\n| take 1\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "2b8133ef-032e-4155-835c-98a16a4844c9",
                        "version": "KqlParameterItem/1.0",
                        "name": "KQLWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Intro to KQL'\r\n| project id\r\n| take 1\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "17c5f260-f802-4f1c-b005-d541f02b904e",
                        "version": "KqlParameterItem/1.0",
                        "name": "AKQLWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Sentinel Cost'\r\n| project id\r\n| take 1\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "fbc180e3-bb37-4db5-a4a0-b59e68624c09",
                        "version": "KqlParameterItem/1.0",
                        "name": "SOCPWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'SOC Process Framework'\r\n| project id\r\n| take 1\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "69a975dc-55fa-40af-9b8a-5ea8ef01306d",
                        "version": "KqlParameterItem/1.0",
                        "name": "CMMC",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'CybersecurityMaturityModelCertificationCMMC'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "c9676ae0-6adf-4890-9172-530a2b208fb5",
                        "version": "KqlParameterItem/1.0",
                        "name": "ZTWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'Zerotrust'\r\n| project id\r\n| take 1\r\n",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      {
                        "id": "074f39b0-0b1a-4144-b6e9-5f1965b5b53a",
                        "version": "KqlParameterItem/1.0",
                        "name": "IRMWB",
                        "type": 1,
                        "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.sourceId has tostring('{Workspace:name}')\r\n| extend Workbook = tostring(properties.displayName)\r\n| where Workbook has 'MicrosoftInsiderRiskManagement'\r\n| project id\r\n| take 1",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "isHiddenWhenLocked": true,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "customWidth": "5",
                  "name": "parameters - 1"
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "3702b087-4c72-458c-9e92-6e05721c296c",
                        "cellValue": "{SOCWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Security Operations Efficiency",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "workbookContext": {
                          "componentIdSource": "parameter",
                          "componentId": "SOCWB",
                          "resourceIdsSource": "parameter",
                          "resourceIds": "SOCWB",
                          "templateIdSource": "parameter",
                          "templateId": "SOCWB",
                          "typeSource": "parameter",
                          "type": "SOCWB",
                          "gallerySource": "workbook",
                          "locationSource": "default"
                        }
                      },
                      {
                        "id": "99b541d8-7a07-49d4-9672-ede85f670f36",
                        "cellValue": "{WUWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Workspace Usage Report",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true
                      },
                      {
                        "id": "80fd9f6d-8705-4425-b548-595b15adece4",
                        "cellValue": "{DCHWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Data Collection Health Monitoring",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true
                      },
                      {
                        "id": "1b4cd3df-3fd7-4d36-92d8-0f3d1f135523",
                        "cellValue": "{MSCWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Microsoft Sentinel Cost Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true
                      },
                      {
                        "id": "72ce1fd4-f755-4168-b6e7-320f1ba07fdc",
                        "cellValue": "{KQLWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Intro to KQL",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true
                      },
                      {
                        "id": "e15acc74-8031-4cf9-894f-bed15114a80f",
                        "cellValue": "{AKQLWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Advanced KQL",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true
                      },
                      {
                        "id": "26dcc230-eeb5-4942-ba11-e49ec51d94be",
                        "cellValue": "{SOCPWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open SOC Process Framework",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true
                      },
                      {
                        "id": "38704821-60bd-4f58-b5dc-475789b96c01",
                        "cellValue": "{CMMC}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open CMMC Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true
                      },
                      {
                        "id": "04b393b0-ae94-4370-ba0f-9d9d64f614e2",
                        "cellValue": "{ZTWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Zero Trust Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true
                      },
                      {
                        "id": "b480216e-d489-44a0-8927-354049b2c6ad",
                        "cellValue": "{IRMWB}",
                        "linkTarget": "Resource",
                        "linkLabel": "Open Insider Risk Management Workbook",
                        "subTarget": "Workbook",
                        "style": "primary",
                        "linkIsContextBlade": true
                      }
                    ]
                  },
                  "customWidth": "50",
                  "name": "links - 2"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "Recommended"
          },
          {
            "type": 1,
            "content": {
              "json": "## If there is a workbook that is of interest that is not listed above, please refer to the Workbook Gallery or Content Hub."
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "text - 8"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "paragraph",
              "links": [
                {
                  "id": "4c8f6a2b-d1db-49b7-9446-0549adaeece4",
                  "linkTarget": "OpenBlade",
                  "linkLabel": "Go to Workbooks Gallery",
                  "style": "primary",
                  "bladeOpenContext": {
                    "bladeName": "WorkbooksBlade",
                    "extensionName": "Microsoft_Azure_Security_Insights"
                  }
                },
                {
                  "id": "6b6fb692-df3b-4057-8049-32431b7e2450",
                  "linkTarget": "OpenBlade",
                  "linkLabel": "Go to Content Hub",
                  "style": "primary",
                  "bladeOpenContext": {
                    "bladeName": "ContentHub.ReactView",
                    "extensionName": "Microsoft_Azure_SentinelUS",
                    "bladeParameters": [
                      {
                        "name": "subscriptionId",
                        "source": "static",
                        "value": "{Subscription:id}"
                      },
                      {
                        "name": "resourceGroup",
                        "source": "static",
                        "value": "{Workspace:resourcegroup}"
                      },
                      {
                        "name": "workspaceName",
                        "source": "static",
                        "value": "{Workspace:name}"
                      }
                    ]
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "links - 0"
          },
          {
            "type": 1,
            "content": {
              "json": "---\r\n\r\n### üìö Workbooks Inventory - Source vs Target\r\n\r\nDetailed comparison of Sentinel workbooks between source and target workspaces for migration tracking.",
              "style": "info"
            },
            "name": "workbooks-inventory-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type == \"microsoft.insights/workbooks\"\n| extend SourceId = tolower(tostring(properties.sourceId))\n| extend Category = tostring(properties.category)\n| where Category =~ \"sentinel\" or SourceId has \"microsoft.securityinsights\"\n| extend SourceWorkspaceId = tolower('{SourceWorkspace}')\n| where SourceId has SourceWorkspaceId\n| extend DisplayName = tostring(properties.displayName)\n| extend WorkbookType = tostring(properties.workbookType)\n| project WorkbookName = DisplayName, ResourceGroup = resourceGroup, Location = location, Type = WorkbookType, Category\n| order by WorkbookName asc",
              "size": 0,
              "title": "üìä Source Workbooks - {SourceWorkspace:name}",
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "customWidth": "50",
            "name": "wb-source-workbooks-list"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type == \"microsoft.insights/workbooks\"\n| extend SourceId = tolower(tostring(properties.sourceId))\n| extend Category = tostring(properties.category)\n| where Category =~ \"sentinel\" or SourceId has \"microsoft.securityinsights\"\n| extend TargetWorkspaceId = tolower('{Workspace}')\n| where SourceId has TargetWorkspaceId\n| extend DisplayName = tostring(properties.displayName)\n| extend WorkbookType = tostring(properties.workbookType)\n| project WorkbookName = DisplayName, ResourceGroup = resourceGroup, Location = location, Type = WorkbookType, Category\n| order by WorkbookName asc",
              "size": 0,
              "title": "üéØ Target Workbooks - {Workspace:name}",
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "filter": true
              }
            },
            "customWidth": "50",
            "name": "wb-target-workbooks-list"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Wb"
      },
      "name": "Workbooks"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### Automation Migration\r\n\r\n*General Best Practices* </br>\r\n\r\n- Inventory all playbooks and automation rules in the source workspace </br>\r\n- Document automation dependencies (API connections, Logic Apps, Functions) </br>\r\n- Export playbooks as ARM templates from source workspace </br>\r\n- Review and update resource references for target workspace </br>\r\n- Recreate API connections in target resource group </br>\r\n- Test playbooks thoroughly before connecting to automation rules </br>\r\n- Review manual processes that can be enhanced during migration </br>\r\n\r\n*Migration Steps* </br>\r\n- Export playbooks (Logic Apps) from source workspace </br>\r\n- Export automation rules configurations </br>\r\n- Recreate API connections with appropriate permissions </br>\r\n- Deploy playbooks to target workspace resource group </br>\r\n- Update automation rules with new playbook references </br>\r\n- Configure managed identities for authentication </br>\r\n\r\n*Considerations Post-Migration* </br>\r\n- Test the automation to confirm that it works. </br>\r\n- Periodically review the automations over time to review if new actions are available to make the automation more efficient or strong. </br>\r\n- Monitor automation performance and health using the Playbook Health Workbook. </br>\r\n- Utilize managed identities and service principals to authenticate within the automation. Azure Key Vault can be utilized to store any secret needed for automation. For more information, see [here](https://docs.microsoft.com/azure/logic-apps/create-managed-service-identity?tabs=consumption) </br>\r\n\r\nFor insights on deploying side-by-side, please refer to https://docs.microsoft.com/azure/sentinel/deploy-side-by-side",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "MigrationTips",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "text - 6"
          },
          {
            "type": 1,
            "content": {
              "json": "### Instructions\r\n\r\nThis tab lists the deployed playbooks within the resource group as well as which automation rules are deployed and have connected playbooks. \r\n\r\nTo review playbook health:\r\n1. Make sure that the Playbook Health workbook is deployed.\r\n2. Click on the 'Check Playbook Health' button.\r\n3. When the context pane opens, click on Workbook.\r\n4. The workbook will be displayed for usage.\r\n\r\nTo review or deploy new automation resources:\r\n1. Click on the 'Deploy Automation Resources' button to open the Automation blade.\r\n2. Navigate the different tabs to review or deploy automation resources as needed.\r\n\r\nRecommended: Look at the Playbooks Gallery to find out-of-the-box templates that are available.",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "Instructions",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "text - 7"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\r\n| where type == \"microsoft.logic/workflows\"\r\n| where resourceGroup == '{Workspace:resourcegroup}'\r\n| extend Name = name\r\n| project Name, ResourceGroup = resourceGroup, Link = id\r\n| sort by Name asc",
              "size": 0,
              "title": "Current Deployed Playbooks in {Workspace:resourcegroup}",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "id",
                    "formatter": 13,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkIsContextBlade": true,
                      "showIcon": true
                    }
                  }
                ],
                "rowLimit": 500,
                "filter": true
              }
            },
            "name": "query - 0"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{Workspace:resourcegroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/automationRules?api-version=2022-07-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$..displayName\",\"columnid\":\"Name\"},{\"path\":\"$..isEnabled\",\"columnid\":\"Enabled\"},{\"path\":\"$..actionType\",\"columnid\":\"Action\"},{\"path\":\"$..actionConfiguration.logicAppResourceId\",\"columnid\":\"LogicApp\"},{\"path\":\"$..lastModifiedTimeUtc\",\"columnid\":\"Modified\"},{\"path\":\"$..lastModifiedBy.name\",\"columnid\":\"Modifier\"},{\"path\":\"$..createdTimeUtc\",\"columnid\":\"Created\"},{\"path\":\"$..createdBy.name\",\"columnid\":\"Creator\"},{\"path\":\"$..actionConfiguration\",\"columnid\":\"ActionConfig\"}]}}]}",
              "size": 0,
              "title": "Automation Rules",
              "queryType": 12,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Enabled",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "true",
                          "representation": "success",
                          "text": "True"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "false",
                          "representation": "4",
                          "text": "False"
                        },
                        {
                          "operator": "Default",
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "id",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Resource",
                      "linkLabel": "Open Resource",
                      "linkIsContextBlade": true
                    }
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "2",
              "comparison": "isEqualTo",
              "value": "3"
            },
            "name": "query - 4"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"7503a3dc-3c59-491f-9af0-1e307879130e\",\"mergeType\":\"innerunique\",\"leftTable\":\"query - 0\",\"rightTable\":\"query - 4\",\"leftColumn\":\"Link\",\"rightColumn\":\"LogicApp\"}],\"projectRename\":[{\"originalName\":\"[query - 4].LogicApp\",\"mergedName\":\"LogicApp\",\"fromId\":\"7503a3dc-3c59-491f-9af0-1e307879130e\"},{\"originalName\":\"[query - 0].Link\",\"mergedName\":\"Link\",\"fromId\":\"7503a3dc-3c59-491f-9af0-1e307879130e\"},{\"originalName\":\"[query - 0].ResourceGroup\",\"mergedName\":\"ResourceGroup\",\"fromId\":\"7503a3dc-3c59-491f-9af0-1e307879130e\"},{\"originalName\":\"[query - 4].Name\",\"mergedName\":\"AutomationRule\",\"fromId\":\"7503a3dc-3c59-491f-9af0-1e307879130e\"},{\"originalName\":\"[query - 4].Enabled\",\"mergedName\":\"Enabled\",\"fromId\":\"7503a3dc-3c59-491f-9af0-1e307879130e\"},{\"originalName\":\"[query - 4].Action\",\"mergedName\":\"Action\",\"fromId\":\"7503a3dc-3c59-491f-9af0-1e307879130e\"},{\"originalName\":\"[query - 4].Modified\",\"mergedName\":\"Modified\",\"fromId\":\"7503a3dc-3c59-491f-9af0-1e307879130e\"},{\"originalName\":\"[query - 4].Modifier\",\"mergedName\":\"Modifier\",\"fromId\":\"7503a3dc-3c59-491f-9af0-1e307879130e\"},{\"originalName\":\"[query - 4].Created\",\"mergedName\":\"Created\",\"fromId\":\"7503a3dc-3c59-491f-9af0-1e307879130e\"},{\"originalName\":\"[query - 4].Creator\",\"mergedName\":\"Creator\",\"fromId\":\"7503a3dc-3c59-491f-9af0-1e307879130e\"},{\"originalName\":\"[query - 4].ActionConfig\",\"mergedName\":\"ActionConfig\",\"fromId\":\"7503a3dc-3c59-491f-9af0-1e307879130e\"},{\"originalName\":\"[query - 0].Name\"}]}",
              "size": 0,
              "title": "Logic Apps Tied to Automation Rules",
              "queryType": 7,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Link",
                    "formatter": 5
                  },
                  {
                    "columnMatch": "ActionConfig",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "GenericDetails",
                      "linkLabel": "Additional Details",
                      "linkIsContextBlade": true
                    }
                  }
                ]
              }
            },
            "showPin": false,
            "name": "query - 5"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "parameters": [
                {
                  "id": "39c11cab-7e6e-4c17-91e2-b596b3f72aa2",
                  "version": "KqlParameterItem/1.0",
                  "name": "PlaybookPath",
                  "type": 1,
                  "query": "resources\r\n| where type == \"microsoft.insights/workbooks\"\r\n| where properties.displayName has 'Playbooks health'\r\n| project id",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "isHiddenWhenLocked": true,
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                }
              ],
              "style": "pills",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources"
            },
            "name": "parameters - 2"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "paragraph",
              "links": [
                {
                  "id": "698ca8f3-3f97-4b77-a29c-d760df9c35ab",
                  "cellValue": "{PlaybookPath}",
                  "linkTarget": "Resource",
                  "linkLabel": "Check Playbook Health",
                  "subTarget": "Workbook",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "workbookContext": {
                    "componentIdSource": "parameter",
                    "componentId": "PlaybookPath",
                    "resourceIdsSource": "parameter",
                    "resourceIds": "PlaybookPath",
                    "templateIdSource": "parameter",
                    "templateId": "PlaybookPath",
                    "typeSource": "parameter",
                    "type": "PlaybookPath",
                    "gallerySource": "workbook",
                    "locationSource": "default"
                  }
                },
                {
                  "id": "ae10c129-5ced-4e14-969c-14ff79304403",
                  "linkTarget": "OpenBlade",
                  "linkLabel": "Deploy Automation Resources",
                  "style": "primary",
                  "bladeOpenContext": {
                    "bladeName": "AutomationBlade",
                    "extensionName": "Microsoft_Azure_Security_Insights"
                  }
                }
              ]
            },
            "name": "links - 1"
          },
          {
            "type": 1,
            "content": {
              "json": "### Please note that any deployment performed in this section will apply to the current Microsoft Sentinel instance, it will not apply to a different instance or workspace chosen above.",
              "style": "warning"
            },
            "conditionalVisibility": {
              "parameterName": "View",
              "comparison": "isEqualTo",
              "value": "Configure"
            },
            "name": "text - 12"
          },
          {
            "type": 1,
            "content": {
              "json": "---\r\n\r\n### ü§ñ Playbooks (Logic Apps) Inventory - Source vs Target\r\n\r\nDetailed comparison of playbooks between source and target subscriptions for migration tracking.\r\n\r\n‚ö†Ô∏è **Important**: Playbooks (Logic Apps) can be in different resource groups than Sentinel workspaces.\r\n\r\nüí° **Tip**: Use tags or naming conventions to identify Sentinel-related playbooks.",
              "style": "info"
            },
            "name": "playbooks-inventory-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type == \"microsoft.logic/workflows\"\n| where subscriptionId =~ '{SourceWorkspace:subscription}'\n| extend State = tostring(properties.state)\n| extend Location = location\n| project PlaybookName = name, ResourceGroup = resourceGroup, Location, State, Tags = tags\n| order by PlaybookName asc",
              "size": 0,
              "title": "üìä Source Playbooks - Subscription: {SourceWorkspace:subscription}",
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "State",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Enabled",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Disabled",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "representation": "info",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true
              }
            },
            "customWidth": "50",
            "name": "auto-source-playbooks-list"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type == \"microsoft.logic/workflows\"\n| where subscriptionId =~ '{Workspace:subscription}'\n| extend State = tostring(properties.state)\n| extend Location = location\n| project PlaybookName = name, ResourceGroup = resourceGroup, Location, State, Tags = tags\n| order by PlaybookName asc",
              "size": 0,
              "title": "üéØ Target Playbooks - Subscription: {Workspace:subscription}",
              "exportToExcelOptions": "all",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "State",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Enabled",
                          "representation": "success",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Disabled",
                          "representation": "disabled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "representation": "info",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true
              }
            },
            "customWidth": "50",
            "name": "auto-target-playbooks-list"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "LA"
      },
      "name": "Automation"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### Instructions\r\n\r\nThis tab lists buttons for managing entity pages as well as a quick glimpse at entity behavior related tables. \r\n\r\nTo configure UEBA: \r\n1. Click on the 'Enable UEBA' button.\r\n2. A context pane will open, click the toggle to 'On'.\r\n3. Select the data sources that should be used for the entity pages.\r\n4. Click save.\r\n\r\nTo customize entity timelines:\r\n1. Click the 'Customize Entity Timeline'.\r\n2. Select a template of interest and go through the deployment wizard.\r\n3. If looking to create custom events, click 'add activity' and complete the wizard process.\r\n",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "Instructions",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "text - 3"
          },
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "paragraph",
              "links": [
                {
                  "id": "1327ace5-dfc9-48c9-9ff3-6153ed00bb17",
                  "linkTarget": "OpenBlade",
                  "linkLabel": "Enable UEBA",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "bladeOpenContext": {
                    "bladeName": "EntityDataSourcesBlade",
                    "extensionName": "Microsoft_Azure_Security_Insights"
                  }
                },
                {
                  "id": "8be12fe8-3cbd-4eb2-a047-e8803fed5303",
                  "linkTarget": "OpenBlade",
                  "linkLabel": "Customize Entity Timeline",
                  "style": "primary",
                  "linkIsContextBlade": true,
                  "bladeOpenContext": {
                    "bladeName": "EntitySettingsBlade",
                    "extensionName": "Microsoft_Azure_Security_Insights",
                    "bladeParameters": [
                      {
                        "name": "id",
                        "source": "static",
                        "value": "EntitySettingsBlade"
                      }
                    ]
                  }
                }
              ]
            },
            "name": "links - 1"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let BA = (BehaviorAnalytics | summarize count() | extend Table = 'BehaviorAnalytics' | extend isEnabled = iff(count_ > 0, 'True', 'False'));\r\nlet II = (IdentityInfo | summarize count() | extend Table = 'IdentityInfo' | extend isEnabled = iff(count_ > 0, 'True', 'False'));\r\nlet UAA = (UserAccessAnalytics | summarize count() | extend Table = 'UserAccessAnalytics' | extend isEnabled = iff(count_ > 0, 'True', 'False'));\r\nlet UPA = (UserPeerAnalytics | summarize count() | extend Table = 'UserPeerAnalytics' | extend isEnabled = iff(count_ > 0, 'True', 'False'));\r\nBA \r\n| union II, UAA, UPA\r\n| project Table, isEnabled\r\n| sort by Table asc",
              "size": 1,
              "timeContextFromParameter": "TimeRange",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ]
            },
            "name": "query - 0"
          },
          {
            "type": 1,
            "content": {
              "json": "## If tables are listed as false:\r\n\r\n- Make sure that the right data sources are enabled that are required for the tables to be ingested.\r\n- Review when UEBA was enabled as certain enrichment tables require a few days to generate data.\r\n- Make sure the time range is set to a higher number. Some tables generate insights on a schedule which may have not been included in a smaller time range.\r\n\r\nFor the IdentityInfo table:\r\n- Changes made to your user profiles in Azure AD are updated in the IdentityInfo table within 15 minutes.\r\n- Group and role information is synchronized between the IdentityInfo table and Azure AD daily.\r\n- Every 21 days, Microsoft Sentinel re-synchronizes with your entire Azure AD to ensure that stale records are fully updated.\r\n- Default retention time in the IdentityInfo table is 30 days.\r\n",
              "style": "info"
            },
            "name": "text - 2"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "UE"
      },
      "name": "UEBA"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "### Historical Data Migration Between Sentinel Workspaces </br>\r\n\r\n*Migration Strategies* </br>\r\n\r\n**Important Considerations:** </br>\r\n- Assess the business value and retention requirements of historical data </br>\r\n- Determine the time range of data that needs to be migrated </br>\r\n- Consider cost implications of data storage and retention </br>\r\n- Plan for data validation and integrity checks post-migration </br>\r\n\r\n**Approach 1: Azure Data Explorer (ADX) for Long-term Storage** </br>\r\n- Export historical data from source workspace to Azure Data Explorer </br>\r\n- Use ADX for cost-effective long-term data storage and querying </br>\r\n- Query historical data alongside current Sentinel data using cross-workspace queries </br>\r\n- [Learn more about Azure Data Explorer](https://docs.microsoft.com/azure/data-explorer/data-explorer-overview) </br>\r\n\r\n**Approach 2: Archive and Restore** </br>\r\n- Leverage workspace data retention and archive policies </br>\r\n- Configure archive settings in the source workspace before migration </br>\r\n- Use Search and Restore to access archived data when needed </br>\r\n- [Data retention and archive](https://docs.microsoft.com/azure/azure-monitor/logs/data-retention-archive) </br>\r\n- [Search and Restore](https://docs.microsoft.com/azure/sentinel/restore) </br>\r\n\r\n**Approach 3: Export and Re-ingest** </br>\r\n- Export data using Log Analytics API or Azure Monitor Logs export </br>\r\n- Store exported data in Azure Storage (cost-effective intermediate storage) </br>\r\n- Re-ingest into target workspace using custom logs API or DCR-based ingestion </br>\r\n- Best for selective data migration or workspace consolidation scenarios </br>\r\n\r\n**Approach 4: Parallel Running Period** </br>\r\n- Keep both workspaces active during transition period </br>\r\n- Allows natural retention expiration in source workspace </br>\r\n- No need to migrate historical data if retention requirements are met </br>\r\n- Use cross-workspace queries to access both during transition </br>\r\n\r\n*Key Decision Factors:* </br>\r\n- **Cost**: Storage costs vs. re-ingestion costs </br>\r\n- **Compliance**: Regulatory requirements for data retention </br>\r\n- **Query Performance**: Need for fast access to historical data </br>\r\n- **Volume**: Amount of data to be migrated </br>\r\n- **Timeline**: Urgency of migration completion </br>",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "MigrationTips",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "text - 9"
          },
          {
            "type": 1,
            "content": {
              "json": "### Instructions\r\n\r\nThis tab lists tables within the workspace and their current configuration for retention and archive. \r\n\r\nTo configure archive:\r\n1. Click on one one of the tables.\r\n2. A section will appear below, within the box provided enter the desired total retention for the table. </br>\r\n\tNote: Archive retention is found by taking TotalRetention and subtracting WorkspaceRetention. So if a table is set to 400 days of total retention and the workspace is only 90 days, the archive retention will be 310 days.\r\n3. Once the total retention is ready, click 'Update Retention'. \r\n4. A context pane will appear to confirm the changes to be made. If all is set, click 'Update Retention' again.\r\n5. To see the changes, refresh the workbook and view the table again.",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "Instructions",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "text - 8"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{Workspace:resourcegroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-12-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties\",\"columns\":[{\"path\":\"$.retentionInDays\",\"columnid\":\"Workspace Retention (days)\"},{\"path\":\"$.sku.name\",\"columnid\":\"Workspace Plan\"},{\"path\":\"$.workspaceCapping.dailyQuotaGb\",\"columnid\":\"Workspace Daily Quota (GB)\",\"substringRegexMatch\":\"^-?[1]\\\\d*(\\\\.\\\\d+)?$\",\"substringReplace\":\"None\"}]}}]}",
              "size": 4,
              "title": "Current Workspace Settings",
              "showRefreshButton": true,
              "queryType": 12,
              "visualization": "table",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Workspace Retention (days)",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "<",
                          "thresholdValue": "90",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "tooltipFormat": {
                      "tooltip": "Microsoft Sentinel provides 90 days of data retention for free"
                    }
                  },
                  {
                    "columnMatch": "Workspace Daily Quota",
                    "formatter": 0,
                    "tooltipFormat": {
                      "tooltip": "You can control your costs by applying a cap to the amount of data that you collect per day"
                    }
                  },
                  {
                    "columnMatch": "RetentionSetting",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "<=",
                          "thresholdValue": "90",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  }
                ]
              },
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "WorkspaceRetention",
                  "formatter": 18,
                  "formatOptions": {
                    "thresholdsOptions": "icons",
                    "thresholdsGrid": [
                      {
                        "operator": "<=",
                        "thresholdValue": "90",
                        "representation": "3",
                        "text": "{0}{1}"
                      },
                      {
                        "operator": "Default",
                        "text": "{0}{1}"
                      }
                    ]
                  }
                },
                "showBorder": true
              }
            },
            "name": "query - 4"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "**Basic Logs**\r\n\r\nThere are two supported plan types, Analytics and Basic. All tables in your Log Analytics are Analytics tables, by default. \r\n\r\nYou can configure particular tables to use **Basic Logs** at reduced priced that have the following limitations:\r\n- Table retention fixed at 8 days\r\n- Alerts are not supported\r\n- Limited KQL language support\r\n\r\nYou can currently configure the following tables for Basic Logs:\r\n\r\n- All tables created with the Data Collection Rule (DCR)-based custom logs API.\r\n- ContainerLog and ContainerLogV2, which Container Insights uses and which include verbose text-based log records.\r\n- AppTraces, which contains freeform log records for application traces in Application Insights.\r\n\r\n[More Information on Basic Logs](https://docs.microsoft.com/azure/azure-monitor/logs/log-analytics-workspace-overview?WT.mc_id=modinfra-0000-rotrent#log-data-plans-preview)\r\n\r\n[Which tables support Basic Logs?](https://docs.microsoft.com/azure/azure-monitor/logs/basic-logs-configure?tabs=api-1%2Cportal-1#which-tables-support-basic-logs)\r\n\r\n[Sending Custom Logs](https://docs.microsoft.com/azure/azure-monitor/logs/custom-logs-overview)\r\n",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "Tab",
                    "comparison": "isEqualTo",
                    "value": "Basic"
                  },
                  "name": "text - 6 - Copy"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "**Data Retention and Archive**\r\n\r\nData in each table in a Log Analytics workspace is retained for a specified period of time after which it's either removed or archived with a reduced retention fee. \r\n\r\n- Set the retention time to balance your requirement for having data available with reducing your cost for data retention.\r\n\r\n[More Information on Data retention and archive](https://docs.microsoft.com/azure/azure-monitor/logs/data-retention-archive)\r\n",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "Tab",
                    "comparison": "isEqualTo",
                    "value": "Archive"
                  },
                  "name": "text - 10 - Copy"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "**Search and Restore**\r\n\r\nThis tab shows current Search and Restore Tables. For more information on Search and Restore please refer to:\r\n\r\n[Search across long time spans in large datasets](https://docs.microsoft.com/azure/sentinel/search-jobs)\r\n\r\n[Restore archived logs from search](https://docs.microsoft.com/azure/sentinel/restore)\r\n",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "Tab",
                    "comparison": "isEqualTo",
                    "value": "Search"
                  },
                  "name": "text - 6"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "You may receive a \"Could not find column 'TableName' in table 'TableRetentionQuery'\" error below, indicating your workspace doesn't currently have any tables that support Basic Plans. \r\n\r\nFor more information on what tables support Basic Logs please refer to:\r\n\r\n[Which tables support Basic Logs?](https://docs.microsoft.com/azure/azure-monitor/logs/basic-logs-configure?tabs=api-1%2Cportal-1#which-tables-support-basic-logs)",
                    "style": "info"
                  },
                  "conditionalVisibility": {
                    "parameterName": "Tab",
                    "comparison": "isEqualTo",
                    "value": "Archive"
                  },
                  "name": "text - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "ShowHelp",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "Help"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "ff66d7b3-6ecd-4d76-9677-7c9496681c58",
                  "version": "KqlParameterItem/1.0",
                  "name": "tablePlanFilter",
                  "label": "Filter by Table Plan and Archive Tier",
                  "type": 10,
                  "isRequired": true,
                  "isGlobal": true,
                  "typeSettings": {
                    "showDefault": false
                  },
                  "jsonData": "[\r\n    { \"value\":\"All\", \"label\":\"All\", \"selected\":true},\r\n    { \"value\":\"Basic\", \"label\":\"Basic Logs\"},\r\n    { \"value\":\"Analytics\", \"label\":\"Analytic Logs\"},\r\n    { \"value\":\"Archived\", \"label\":\"Archived Tables\"},\r\n    { \"value\":\"Default\", \"label\":\"Default Retention Tables\"}\r\n]",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "formVertical",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 3"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "eceba9b6-6afa-456c-acf1-fa1e02c3d182",
                        "version": "KqlParameterItem/1.0",
                        "name": "basicTablePlanFilter",
                        "type": 10,
                        "isRequired": true,
                        "isGlobal": true,
                        "isHiddenWhenLocked": true,
                        "typeSettings": {
                          "showDefault": false
                        },
                        "jsonData": "[\r\n    { \"value\":\"(@.properties.plan=='Basic')\", \"label\":\"Supported Basic Logs\", \"selected\":true }\r\n]",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "pills",
                    "doNotRunWhenHidden": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "name": "parameters - 4"
                }
              ],
              "exportParameters": true
            },
            "name": "Basic Log Filters"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "6431576b-55b8-4ab1-8c44-59f052268f36",
                  "version": "KqlParameterItem/1.0",
                  "name": "tableFilter",
                  "type": 1,
                  "isRequired": true,
                  "isGlobal": true,
                  "isHiddenWhenLocked": true,
                  "criteriaData": [
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "Archive",
                        "resultValType": "param",
                        "resultVal": "tablePlanFilter"
                      }
                    },
                    {
                      "criteriaContext": {
                        "leftOperand": "Tab",
                        "operator": "==",
                        "rightValType": "static",
                        "rightVal": "Basic",
                        "resultValType": "param",
                        "resultVal": "basicTablePlanFilter"
                      }
                    },
                    {
                      "criteriaContext": {
                        "operator": "Default",
                        "resultValType": "param",
                        "resultVal": "tablePlanFilter"
                      }
                    }
                  ],
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "pills",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 10"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Select a table below to update settings",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{Workspace:resourcegroup}/providers/microsoft.operationalinsights/workspaces/{Workspace:name}/tables?api-version=2021-12-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.plan=='Basic' || @.properties.plan=='Analytics')]\",\"columns\":[{\"path\":\"$.name\",\"columnid\":\"TableName\"},{\"path\":\"$.properties.schema.tableType\",\"columnid\":\"TableType\"},{\"path\":\"$.properties.plan\",\"columnid\":\"TablePlan\"},{\"path\":\"$.properties.retentionInDays\",\"columnid\":\"TableInteractivePeriod\"},{\"path\":\"$.properties.archiveRetentionInDays\",\"columnid\":\"TableArchivePeriod\"},{\"path\":\"$.properties.totalRetentionInDays\",\"columnid\":\"TotalRetentionPeriod\"},{\"path\":\"$.properties.lastPlanModifiedDate\",\"columnid\":\"lastPlanModifiedDate\",\"columnType\":\"datetime\"}]}}]}",
                    "size": 1,
                    "title": "Retention settings for {tablePlanFilter:label}",
                    "noDataMessage": "No tables found matching this filter. This may be normal if you don't have tables with this plan configured.",
                    "showRefreshButton": true,
                    "queryType": 12,
                    "exportedParameters": [
                      {
                        "fieldName": "TableName",
                        "parameterName": "TableName",
                        "parameterType": 1
                      }
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "filter": true,
                      "formatters": [
                        {
                          "columnMatch": "TablePlan",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Basic",
                                "representation": "blue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Analytics",
                                "representation": "green",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "gray",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "TableInteractivePeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "TableArchivePeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "purple"
                          }
                        },
                        {
                          "columnMatch": "TotalRetentionPeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenDark"
                          }
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "TablePlan",
                          "label": "Table Plan"
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "TableInteractivePeriod",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TableInteractivePeriod",
                        "sortOrder": 1
                      }
                    ],
                    "tileSettings": {
                      "showBorder": false,
                      "titleContent": {
                        "columnMatch": "TablePlan",
                        "formatter": 1
                      },
                      "leftContent": {
                        "columnMatch": "TableInteractivePeriod",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "auto"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "tablePlanFilter",
                    "comparison": "isEqualTo",
                    "value": "All"
                  },
                  "name": "TableRetentionQuery"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{Workspace:resourcegroup}/providers/microsoft.operationalinsights/workspaces/{Workspace:name}/tables?api-version=2021-12-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.plan=='Basic')]\",\"columns\":[{\"path\":\"$.name\",\"columnid\":\"TableName\"},{\"path\":\"$.properties.schema.tableType\",\"columnid\":\"TableType\"},{\"path\":\"$.properties.plan\",\"columnid\":\"TablePlan\"},{\"path\":\"$.properties.retentionInDays\",\"columnid\":\"TableInteractivePeriod\"},{\"path\":\"$.properties.archiveRetentionInDays\",\"columnid\":\"TableArchivePeriod\"},{\"path\":\"$.properties.totalRetentionInDays\",\"columnid\":\"TotalRetentionPeriod\"},{\"path\":\"$.properties.lastPlanModifiedDate\",\"columnid\":\"lastPlanModifiedDate\",\"columnType\":\"datetime\"}]}}]}",
                    "size": 1,
                    "title": "Retention settings for {tablePlanFilter:label}",
                    "noDataMessage": "No Basic Log tables found. Basic logs may not be configured in this workspace.",
                    "showRefreshButton": true,
                    "queryType": 12,
                    "exportedParameters": [
                      {
                        "fieldName": "TableName",
                        "parameterName": "TableName",
                        "parameterType": 1
                      }
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "filter": true,
                      "formatters": [
                        {
                          "columnMatch": "TablePlan",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Basic",
                                "representation": "blue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "gray",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "TableInteractivePeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "TableArchivePeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "purple"
                          }
                        },
                        {
                          "columnMatch": "TotalRetentionPeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenDark"
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "TableInteractivePeriod",
                          "sortOrder": 1
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "tablePlanFilter",
                    "comparison": "isEqualTo",
                    "value": "Basic"
                  },
                  "name": "TableRetentionQuery"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{Workspace:resourcegroup}/providers/microsoft.operationalinsights/workspaces/{Workspace:name}/tables?api-version=2021-12-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.plan=='Analytics')]\",\"columns\":[{\"path\":\"$.name\",\"columnid\":\"TableName\"},{\"path\":\"$.properties.schema.tableType\",\"columnid\":\"TableType\"},{\"path\":\"$.properties.plan\",\"columnid\":\"TablePlan\"},{\"path\":\"$.properties.retentionInDays\",\"columnid\":\"TableInteractivePeriod\"},{\"path\":\"$.properties.archiveRetentionInDays\",\"columnid\":\"TableArchivePeriod\"},{\"path\":\"$.properties.totalRetentionInDays\",\"columnid\":\"TotalRetentionPeriod\"},{\"path\":\"$.properties.lastPlanModifiedDate\",\"columnid\":\"lastPlanModifiedDate\",\"columnType\":\"datetime\"}]}}]}",
                    "size": 1,
                    "title": "Retention settings for {tablePlanFilter:label}",
                    "noDataMessage": "No Analytic Log tables found.",
                    "showRefreshButton": true,
                    "queryType": 12,
                    "exportedParameters": [
                      {
                        "fieldName": "TableName",
                        "parameterName": "TableName",
                        "parameterType": 1
                      }
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "filter": true,
                      "formatters": [
                        {
                          "columnMatch": "TablePlan",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Analytics",
                                "representation": "green",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "gray",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "TableInteractivePeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "TableArchivePeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "purple"
                          }
                        },
                        {
                          "columnMatch": "TotalRetentionPeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenDark"
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "TableInteractivePeriod",
                          "sortOrder": 1
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "tablePlanFilter",
                    "comparison": "isEqualTo",
                    "value": "Analytics"
                  },
                  "name": "TableRetentionQuery"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{Workspace:resourcegroup}/providers/microsoft.operationalinsights/workspaces/{Workspace:name}/tables?api-version=2021-12-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.archiveRetentionInDays > 0)]\",\"columns\":[{\"path\":\"$.name\",\"columnid\":\"TableName\"},{\"path\":\"$.properties.schema.tableType\",\"columnid\":\"TableType\"},{\"path\":\"$.properties.plan\",\"columnid\":\"TablePlan\"},{\"path\":\"$.properties.retentionInDays\",\"columnid\":\"TableInteractivePeriod\"},{\"path\":\"$.properties.archiveRetentionInDays\",\"columnid\":\"TableArchivePeriod\"},{\"path\":\"$.properties.totalRetentionInDays\",\"columnid\":\"TotalRetentionPeriod\"},{\"path\":\"$.properties.lastPlanModifiedDate\",\"columnid\":\"lastPlanModifiedDate\",\"columnType\":\"datetime\"}]}}]}",
                    "size": 1,
                    "title": "Retention settings for {tablePlanFilter:label}",
                    "noDataMessage": "No archived tables found. Archive retention may not be configured.",
                    "showRefreshButton": true,
                    "queryType": 12,
                    "exportedParameters": [
                      {
                        "fieldName": "TableName",
                        "parameterName": "TableName",
                        "parameterType": 1
                      }
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "filter": true,
                      "formatters": [
                        {
                          "columnMatch": "TablePlan",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Basic",
                                "representation": "blue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Analytics",
                                "representation": "green",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "gray",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "TableInteractivePeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "TableArchivePeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "purple"
                          }
                        },
                        {
                          "columnMatch": "TotalRetentionPeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenDark"
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "TableArchivePeriod",
                          "sortOrder": 2
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "tablePlanFilter",
                    "comparison": "isEqualTo",
                    "value": "Archived"
                  },
                  "name": "TableRetentionQuery"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{Workspace:resourcegroup}/providers/microsoft.operationalinsights/workspaces/{Workspace:name}/tables?api-version=2021-12-01-preview\",\"urlParams\":[],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.properties.archiveRetentionInDays == 0 || !@.properties.archiveRetentionInDays)]\",\"columns\":[{\"path\":\"$.name\",\"columnid\":\"TableName\"},{\"path\":\"$.properties.schema.tableType\",\"columnid\":\"TableType\"},{\"path\":\"$.properties.plan\",\"columnid\":\"TablePlan\"},{\"path\":\"$.properties.retentionInDays\",\"columnid\":\"TableInteractivePeriod\"},{\"path\":\"$.properties.archiveRetentionInDays\",\"columnid\":\"TableArchivePeriod\"},{\"path\":\"$.properties.totalRetentionInDays\",\"columnid\":\"TotalRetentionPeriod\"},{\"path\":\"$.properties.lastPlanModifiedDate\",\"columnid\":\"lastPlanModifiedDate\",\"columnType\":\"datetime\"}]}}]}",
                    "size": 1,
                    "title": "Retention settings for {tablePlanFilter:label}",
                    "noDataMessage": "No default retention tables found.",
                    "showRefreshButton": true,
                    "queryType": 12,
                    "exportedParameters": [
                      {
                        "fieldName": "TableName",
                        "parameterName": "TableName",
                        "parameterType": 1
                      }
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "filter": true,
                      "formatters": [
                        {
                          "columnMatch": "TablePlan",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Basic",
                                "representation": "blue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Analytics",
                                "representation": "green",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "gray",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "TableInteractivePeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "TableArchivePeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "purple"
                          }
                        },
                        {
                          "columnMatch": "TotalRetentionPeriod",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenDark"
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "TableInteractivePeriod",
                          "sortOrder": 1
                        }
                      ]
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "tablePlanFilter",
                    "comparison": "isEqualTo",
                    "value": "Default"
                  },
                  "name": "TableRetentionQuery"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| summarize arg_max(TimeGenerated, *) by DataType\r\n| project DataType, Quantity, QuantityUnit, IsBillable\r\n| order by DataType asc",
                    "size": 0,
                    "title": "Tables Found in the {WorkspaceName} workspace",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "exportFieldName": "DataType",
                    "exportParameterName": "DataType",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{Workspace}"
                    ],
                    "gridSettings": {
                      "sortBy": [
                        {
                          "itemKey": "DataType",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "DataType",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "ShowHiddenObjects",
                    "comparison": "isEqualTo",
                    "value": "Yes"
                  },
                  "name": "LAWTableQuery"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\",\"mergeType\":\"inner\",\"leftTable\":\"TableRetentionQuery\",\"rightTable\":\"LAWTableQuery\",\"leftColumn\":\"TableName\",\"rightColumn\":\"DataType\"}],\"projectRename\":[{\"originalName\":\"[TableRetentionQuery].TableName\",\"mergedName\":\"TableName\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[TableRetentionQuery].TableType\",\"mergedName\":\"TableType\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[TableRetentionQuery].TablePlan\",\"mergedName\":\"TablePlan\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[TableRetentionQuery].TableInteractivePeriod\",\"mergedName\":\"InteractiveRetention\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[TableRetentionQuery].TableArchivePeriod\",\"mergedName\":\"ArchiveRetention\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[TableRetentionQuery].TotalRetentionPeriod\",\"mergedName\":\"TotalRetention\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[LAWTableQuery].Quantity\",\"mergedName\":\"TableSize\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[LAWTableQuery].QuantityUnit\",\"mergedName\":\"SizeUnit\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[LAWTableQuery].IsBillable\",\"mergedName\":\"IsBillable\",\"fromId\":\"unknown\"},{\"originalName\":\"[TableRetentionQuery].lastPlanModifiedDate\",\"mergedName\":\"lastPlanModifiedDate\",\"fromId\":\"e3a3f78c-f05b-458f-85ec-2bc8e5821101\"},{\"originalName\":\"[LAWTableQuery].DataType\"}]}",
                    "size": 1,
                    "noDataMessage": "It appears your workspace doesn't currently have any tables that support Basic Plans or there are not any archived tables.",
                    "showRefreshButton": true,
                    "exportedParameters": [
                      {
                        "fieldName": "TableName",
                        "parameterName": "TableName",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "TablePlan",
                        "parameterName": "TablePlan",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "InteractiveRetention",
                        "parameterName": "InteractiveRetention",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "ArchiveRetention",
                        "parameterName": "ArchiveRetention",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "TotalRetention",
                        "parameterName": "TotalRetention",
                        "parameterType": 1
                      },
                      {
                        "parameterType": 1
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TableName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "38.5714ch"
                          }
                        },
                        {
                          "columnMatch": "TableType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15ch"
                          }
                        },
                        {
                          "columnMatch": "TablePlan",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Basic",
                                "representation": "blue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Analytics",
                                "representation": "green",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "gray",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "15ch"
                          }
                        },
                        {
                          "columnMatch": "TableSize",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15ch"
                          }
                        },
                        {
                          "columnMatch": "SizeUnit",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "14ch"
                          }
                        },
                        {
                          "columnMatch": "InteractiveRetention",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "blue",
                            "customColumnWidthSetting": "22.8571ch"
                          }
                        },
                        {
                          "columnMatch": "ArchiveRetention",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "purple",
                            "customColumnWidthSetting": "20.8571ch"
                          }
                        },
                        {
                          "columnMatch": "TotalRetention",
                          "formatter": 8,
                          "formatOptions": {
                            "palette": "greenDark",
                            "customColumnWidthSetting": "18.2857ch"
                          }
                        },
                        {
                          "columnMatch": "IsBillable",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "false",
                                "representation": "Unavailable",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "unknown",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "Last Updated Time",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "26ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TotalRetention",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TotalRetention",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "name": "query - 9 - Copy"
                }
              ],
              "exportParameters": true
            },
            "name": "TableReport"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":\"{\\r\\n\\t\\\"properties\\\":{\\r\\n\\t\\t\\\"retentionInDays\\\": 180,\\r\\n\\t\\t\\\"totalRetentionInDays\\\": 200 \\r\\n\\t}\\r\\n}\",\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourcegroups/{Workspace:resourcegroup}/providers/microsoft.operationalinsights/workspaces/{Workspace:name}/tables/{TableName}\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-12-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.properties\",\"columns\":[{\"path\":\"$.schema.name\",\"columnid\":\"Name\"},{\"path\":\"$.plan\",\"columnid\":\"TablePlan\"},{\"path\":\"$.retentionInDays\",\"columnid\":\"InteractiveRetentionPeriod\"},{\"path\":\"$.archiveRetentionInDays\",\"columnid\":\"ArchiveRetentionPeriod\"},{\"path\":\"$.totalRetentionInDays\",\"columnid\":\"TotalRetentionPeriod\"}]}}]}",
                    "size": 4,
                    "title": "Retention for the {TableName} Table in Days",
                    "showRefreshButton": true,
                    "queryType": 12
                  },
                  "conditionalVisibility": {
                    "parameterName": "TableName",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "query - 1"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "<span style= \"font-size:15px;\">You are about to modify the settings of the **{TableName}** table to enable **Archive Logs**.</span>\r\n\r\n<span style= \"font-size:15px;\">This will modify the **{TableName}** table with a different retention period from the default workspace retntion period of {workspaceRetention} days up to 7 years (2,555 days)</span>\r\n\r\n> **Note:** Tables will inherit the retention of workspace unless changed. \r\n- If a retention is set on a table and the workspace retention is changed, the table retention will not be affected. \r\n- To **reset** the table retention to the workspace retention, select the **Reset Retention** button\r\n- You can access archived data by running a **search job** or **restoring archived logs**\r\n- You can set the workspace default retention policy in the Azure portal to 30, 31, 60, 90, 120, 180, 270, 365, 550, and 730 days. \r\n",
                    "style": "warning"
                  },
                  "customWidth": "50",
                  "conditionalVisibility": {
                    "parameterName": "TableName",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "ca66bbc0-8300-419d-9baf-2add3c5f2c37",
                        "version": "KqlParameterItem/1.0",
                        "name": "totalRetentionInDays",
                        "label": "Total Retention in Days",
                        "type": 1,
                        "description": "The table's total data retention including archive period. Set this property to null if you don't want to archive data.",
                        "isRequired": true,
                        "value": "100",
                        "timeContext": {
                          "durationMs": 86400000
                        }
                      }
                    ],
                    "style": "formVertical",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "TableName",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "parameters - 7",
                  "styleSettings": {
                    "margin": "0px",
                    "padding": "0px"
                  }
                },
                {
                  "type": 11,
                  "content": {
                    "version": "LinkItem/1.0",
                    "style": "list",
                    "links": [
                      {
                        "id": "d0307859-0760-4b9a-972f-297a5be4efda",
                        "linkTarget": "ArmAction",
                        "linkLabel": "Update Retention",
                        "postText": "",
                        "style": "primary",
                        "linkIsContextBlade": true,
                        "armActionContext": {
                          "path": "{Subscription}/resourcegroups/{resourceGroup}/providers/microsoft.operationalinsights/workspaces/{WorkspaceName}/tables/{TableName}",
                          "params": [
                            {
                              "key": "api-version",
                              "value": "2021-12-01-preview"
                            }
                          ],
                          "body": "{\r\n\t\"properties\":{\r\n\t\t\"retentionInDays\": null,\r\n\t\t\"totalRetentionInDays\": \"{totalRetentionInDays}\"\r\n\t}\r\n}",
                          "httpMethod": "PATCH",
                          "title": "Caution",
                          "description": "## ARM actions can potentially modify resources.\n\n<span style= \"font-size:15px;\"> You are updating the **{TableName}** table to the Archive tier with a total retention period of **{totalRetentionInDays} days** </span>\n\nThe current table retention period is set to:\n\n- InteractiveRetention: {InteractiveRetention}\n- ArchiveRetention: {ArchiveRetention}\n- TotalRetention: {TotalRetention}",
                          "actionName": "Update Table Retention Settings",
                          "runLabel": "Update Retention"
                        }
                      },
                      {
                        "id": "c633cc9c-af9a-484e-9a68-a5519ffd6374",
                        "linkTarget": "OpenBlade",
                        "linkLabel": "Update Retenion in UI",
                        "style": "primary",
                        "bladeOpenContext": {
                          "bladeName": "TablesBlade",
                          "extensionName": "Microsoft_OperationsManagementSuite_Workspace",
                          "bladeParameters": [
                            {
                              "name": "workspaceResourceId",
                              "source": "parameter",
                              "value": "Workspace"
                            }
                          ]
                        }
                      },
                      {
                        "id": "4a94621f-22d3-4330-8340-5624503fd3ea",
                        "linkTarget": "ArmAction",
                        "linkLabel": "Reset Retention",
                        "style": "secondary",
                        "linkIsContextBlade": true,
                        "armActionContext": {
                          "path": "{Subscription}/resourcegroups/{resourceGroup}/providers/microsoft.operationalinsights/workspaces/{WorkspaceName}/tables/{TableName}",
                          "params": [
                            {
                              "key": "api-version",
                              "value": "2021-12-01-preview"
                            }
                          ],
                          "body": "{\r\n    \"properties\": {\r\n        \"retentionInDays\": -1,\r\n        \"totalRetentionInDays\": -1\r\n    }\r\n}",
                          "httpMethod": "PATCH",
                          "title": "Caution",
                          "description": "## ARM actions can potentially modify resources.\n\n<span style= \"font-size:15px;\"> You are reseting the **{TableName}** table to the workspace default retention period pf {InteractiveRetention} days </span>\n\nThe current table retention period is set to:\n\n- InteractiveRetention: {InteractiveRetention}\n- ArchiveRetention: {ArchiveRetention}\n- TotalRetention: {TotalRetention}",
                          "actionName": "Update Table Retention Settings",
                          "runLabel": "Reset Retention"
                        }
                      }
                    ]
                  },
                  "customWidth": "25",
                  "conditionalVisibility": {
                    "parameterName": "TableName",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "links - 4",
                  "styleSettings": {
                    "margin": "0px",
                    "padding": "21px"
                  }
                }
              ]
            },
            "name": "Archive"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "DM"
      },
      "name": "DM"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Sentinel to Sentinel Migration Overview",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# üöÄ Microsoft Sentinel to Sentinel Migration Guide\n\n## üìã Migration Configuration\n\n| Property | Value |\n|----------|-------|\n| **Source Workspace** | {SourceWorkspace:name} |\n| **Target Workspace** | {Workspace:name} |\n| **Source Region** | {SourceWorkspace:location} |\n| **Target Region** | {Workspace:location} |\n\n---\n\n## üéØ Common Migration Scenarios\n\n### üîÑ Workspace Consolidation\n**Use Case:** Merging multiple Sentinel workspaces into one\n**Benefits:** Reduced management overhead, unified visibility, simplified RBAC\n**Key Considerations:**\n- Connector ingestion limits (review daily ingestion caps)\n- RBAC complexity increases with consolidated access\n- Data retention policies may need adjustment\n- Cost optimization through unified commitment tiers\n\n### üåç Region Migration\n**Use Case:** Moving workspace to different Azure region\n**Benefits:** Compliance, data residency, latency reduction\n**Key Considerations:**\n- Zero data migration (cannot move logs between regions)\n- Full infrastructure-as-code recreation recommended\n- Plan for parallel operation during transition\n- Update firewall rules and network configurations\n\n### üè¢ Tenant Migration\n**Use Case:** M&A, organizational restructuring\n**Benefits:** Align with new identity structure\n**Key Considerations:**\n- Most complex migration type - full rebuild required\n- Service principals and managed identities must be recreated\n- Data cannot be migrated automatically\n- Requires extensive automation/IaC approach\n\n### üíº Subscription Reorganization\n**Use Case:** Cost center changes, billing realignment\n**Benefits:** Proper cost allocation and governance\n**Key Considerations:**\n- Some resources can move, others require recreation\n- Verify resource move support for all dependencies\n- Update cost allocation tags and policies\n\n---\n\n## üõ†Ô∏è Sentinel-as-Code Migration Strategy\n\n### ‚≠ê **Recommended Approach: YAML + Infrastructure as Code**\n\nThe **best practice** for Sentinel migrations is to manage Analytics Rules in YAML format and use IaC for deployment. This ensures:\n- ‚úÖ Human-readable format for version control\n- ‚úÖ Easy collaboration and code review\n- ‚úÖ Community standard (GitHub, Content Hub use YAML)\n- ‚úÖ Automated conversion to deployable ARM templates\n- ‚úÖ Repeatable, auditable deployments\n\n---\n\n### üì¶ Content Management: YAML Workflow (Recommended)\n\n#### **Option 1: YAML Format** ‚≠ê BEST PRACTICE\n\n**Why YAML?**\n- Industry standard for Sentinel Analytics Rules\n- All Microsoft and community rules published in YAML\n- Human-readable and easy to edit\n- Git-friendly for collaboration\n- Converts to ARM/Bicep for deployment\n\n**YAML Structure Example:**\n```yaml\nid: 12345678-1234-1234-1234-123456789012\nname: Suspicious Sign-in Activity\ndescription: Detects suspicious sign-in patterns\nseverity: Medium\nstatus: Available\nrequiredDataConnectors:\n  - connectorId: AzureActiveDirectory\n    dataTypes:\n      - SigninLogs\nqueryFrequency: 1h\nqueryPeriod: 1h\ntriggerOperator: GreaterThan\ntriggerThreshold: 0\ntactics:\n  - InitialAccess\n  - CredentialAccess\nquery: |\n  SigninLogs\n  | where ResultType != 0\n  | where Location !in (\"US\", \"GB\")\n  | summarize FailedAttempts = count() by UserPrincipalName, IPAddress\n  | where FailedAttempts > 5\n```\n\n#### **üîß Sentinel-AR-Converter Tool** (by Fabian Bader)\n\n**The Swiss Army Knife for Analytics Rules**\n\nConvert between YAML and ARM templates seamlessly:\n\n**Installation:**\n```powershell\nInstall-Module -Name SentinelARConverter\nImport-Module SentinelARConverter\n```\n\n**Convert ARM/JSON to YAML:**\n```powershell\n# Single file\nConvert-SentinelARArmToYaml -Filename \"C:\\rules\\rule.json\" -UseOriginalFilename\n\n# Entire directory\nGet-ChildItem \"C:\\rules\\*.json\" | ForEach-Object {\n    Convert-SentinelARArmToYaml -Filename $_.FullName -UseOriginalFilename\n}\n```\n\n**Convert YAML to ARM for deployment:**\n```powershell\n# Single file\nConvert-SentinelARYamlToArm -Filename \"C:\\rules\\rule.yaml\" -UseOriginalFilename\n\n# Entire directory (prepare for deployment)\nGet-ChildItem \"C:\\rules\\*.yaml\" | ForEach-Object {\n    Convert-SentinelARYamlToArm -Filename $_.FullName -OutFile \"C:\\deploy\\$($_.BaseName).json\"\n}\n```\n\n**GitHub Repository:** https://github.com/f-bader/SentinelARConverter\n**PowerShell Gallery:** https://www.powershellgallery.com/packages/SentinelARConverter\n\n**Typical Workflow:**\n1. Export Analytics Rules from source workspace as ARM/JSON\n2. Convert to YAML using `Convert-SentinelARArmToYaml`\n3. Store YAML files in Git repository (version control)\n4. Review, edit, and collaborate on YAML files\n5. Convert back to ARM using `Convert-SentinelARYamlToArm`\n6. Deploy ARM templates to target workspace\n\n---\n\n### üì¶ Deployment Options (After Conversion)\n\n#### **Option 1: ARM Templates** (Azure Native)\n\n**After converting YAML to ARM with Sentinel-AR-Converter:**\n\n```plaintext\n‚úÖ Pros:\n  ‚Ä¢ Native Azure support\n  ‚Ä¢ Direct deployment via Azure CLI/PowerShell\n  ‚Ä¢ No additional dependencies\n  ‚Ä¢ Integrates with Azure DevOps/GitHub Actions\n\n‚ö†Ô∏è Cons:\n  ‚Ä¢ JSON syntax (use YAML as source of truth)\n  ‚Ä¢ Generated files, not hand-edited\n\nüìù Best For: Standard deployments after YAML conversion\n```\n\n**Deployment Commands:**\n```bash\n# Deploy converted ARM template\naz deployment group create \\\n  --resource-group <target-rg> \\\n  --template-file rule.json \\\n  --parameters workspace=<target-workspace>\n\n# Batch deploy multiple rules\nfor file in deploy/*.json; do\n  az deployment group create \\\n    --resource-group <target-rg> \\\n    --template-file \"$file\" \\\n    --parameters workspace=<target-workspace>\ndone\n```\n\n#### **Option 2: Bicep** (Modern ARM)\n\n```plaintext\n‚úÖ Pros:\n  ‚Ä¢ Cleaner syntax than ARM JSON\n  ‚Ä¢ Type safety and IntelliSense\n  ‚Ä¢ Modules for reusability\n  ‚Ä¢ Can convert ARM to Bicep\n\n‚ö†Ô∏è Cons:\n  ‚Ä¢ Extra conversion step\n  ‚Ä¢ Still Azure-specific\n\nüìù Best For: Teams already using Bicep, infrastructure deployments\n```\n\n**Convert ARM to Bicep:**\n```bash\n# After YAML to ARM conversion, convert to Bicep\naz bicep decompile --file rule.json\n\n# Deploy Bicep\naz deployment group create \\\n  --resource-group <target-rg> \\\n  --template-file rule.bicep \\\n  --parameters workspace=<target-workspace>\n```\n\n#### **Option 3: Microsoft Sentinel Repositories** (GitOps) ‚≠ê AUTOMATION\n\n```plaintext\n‚úÖ Pros:\n  ‚Ä¢ Native Sentinel integration\n  ‚Ä¢ Automatic deployment from GitHub/Azure DevOps\n  ‚Ä¢ Supports YAML format natively\n  ‚Ä¢ Built-in version control\n  ‚Ä¢ Automatic sync on commit\n\n‚ö†Ô∏è Cons:\n  ‚Ä¢ Only handles content (not infrastructure)\n  ‚Ä¢ Limited to: Analytics Rules, Workbooks, Playbooks, Hunting Queries\n  ‚Ä¢ Requires GitHub or Azure DevOps\n\nüìù Best For: Automated deployment, GitOps workflows ‚≠ê RECOMMENDED\n```\n\n**Setup Process:**\n1. **In Sentinel:** Settings ‚Üí Repositories ‚Üí Add repository\n2. **Connect:** Link GitHub or Azure DevOps repository\n3. **Configure:** Select branch and content path\n4. **Deploy:** YAML files auto-deploy on commit\n\n**Repository Structure:**\n```\nsentinel-content/\n‚îú‚îÄ‚îÄ Analytics Rules/\n‚îÇ   ‚îú‚îÄ‚îÄ Brute Force/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BruteForceSSH.yaml\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BruteForceRDP.yaml\n‚îÇ   ‚îî‚îÄ‚îÄ Malware/\n‚îÇ       ‚îî‚îÄ‚îÄ MaliciousInbox.yaml\n‚îú‚îÄ‚îÄ Workbooks/\n‚îÇ   ‚îî‚îÄ‚îÄ SOCOverview.json\n‚îî‚îÄ‚îÄ Playbooks/\n    ‚îî‚îÄ‚îÄ BlockUser.json\n```\n\n**Benefits:**\n- Commit to main branch ‚Üí Automatic deployment to Sentinel\n- Pull requests for rule review before deployment\n- Rollback by reverting Git commits\n- Full audit trail in Git history\n\n---\n\n### üö´ Terraform: Not Recommended for Analytics Rules\n\nWhile Terraform is powerful for infrastructure, it has **significant limitations** for Sentinel content:\n\n```plaintext\n‚ö†Ô∏è Limitations:\n  ‚Ä¢ Analytics Rules provider support is incomplete\n  ‚Ä¢ YAML format not natively supported\n  ‚Ä¢ State file complexity for content management\n  ‚Ä¢ Community tools (YAML) not compatible\n  ‚Ä¢ Rule updates require Terraform workflow\n\n‚úÖ Better Use Cases for Terraform:\n  ‚Ä¢ Workspace provisioning\n  ‚Ä¢ Networking and private endpoints\n  ‚Ä¢ Data connectors (limited)\n  ‚Ä¢ Infrastructure-level resources\n```\n\n**Recommendation:** Use **YAML + Sentinel Repositories** for content, **Terraform/Bicep** for infrastructure.\n\n---\n\n## üìä Migration Phases (Detailed)\n\n### Phase 1: üîç Assessment & Discovery\n**Duration:** 1-2 weeks\n**Objectives:**\n- [ ] Complete inventory of source workspace\n  - Export Analytics Rules as ARM/JSON templates\n  - Document workbooks and dashboards\n  - List playbooks and automation rules\n  - Measure data connector ingestion volumes\n  - Export watchlists to CSV\n  - Document custom parsers and functions\n  - Note UEBA and entity configurations\n- [ ] Convert exported rules to YAML\n  ```powershell\n  Convert-SentinelARArmToYaml -Filename \"exported-rules.json\" -UseOriginalFilename\n  ```\n- [ ] Store YAML in Git repository\n- [ ] Document dependencies between components\n\n**Key Tools:**\n- This Migration Tracker Workbook\n- Sentinel-AR-Converter PowerShell module\n- Azure CLI for resource export\n- Git for version control\n\n### Phase 2: üèóÔ∏è Design & Preparation\n**Duration:** 2-4 weeks\n**Objectives:**\n- [ ] Set up Git repository structure\n  ```\n  sentinel-migration/\n  ‚îú‚îÄ‚îÄ source/         # Exported YAML from source\n  ‚îú‚îÄ‚îÄ target/         # Modified rules for target\n  ‚îú‚îÄ‚îÄ templates/      # ARM templates (generated)\n  ‚îî‚îÄ‚îÄ docs/           # Migration documentation\n  ```\n- [ ] Review and update YAML files\n  - Update workspace references\n  - Adjust thresholds if needed\n  - Add/remove connectors based on target\n  - Update entity mappings\n- [ ] Set up Sentinel Repositories in target workspace\n- [ ] Create CI/CD pipeline (optional but recommended)\n  ```yaml\n  # GitHub Actions example\n  name: Deploy Analytics Rules\n  on:\n    push:\n      branches: [ main ]\n      paths: [ 'Analytics Rules/**' ]\n  jobs:\n    deploy:\n      runs-on: ubuntu-latest\n      steps:\n        - uses: actions/checkout@v2\n        - name: Deploy to Sentinel\n          # Sentinel Repositories handles deployment automatically\n  ```\n\n### Phase 3: üîÑ Parallel Operation\n**Duration:** 2-8 weeks\n**Objectives:**\n- [ ] Deploy YAML content to target workspace\n  - Push YAML files to connected repository\n  - Sentinel Repositories auto-deploys\n  - Verify rules are enabled\n  - Validate queries execute successfully\n- [ ] Configure dual data ingestion\n  - Enable connectors in both workspaces\n  - Verify data flow to target\n- [ ] Compare alert volumes\n  ```kql\n  // In each workspace\n  SecurityAlert\n  | where TimeGenerated > ago(7d)\n  | summarize AlertCount = count() by AlertName\n  | order by AlertCount desc\n  ```\n- [ ] Test incident response in target workspace\n\n### Phase 4: ‚úÖ Migration & Cutover\n**Duration:** 1-2 days\n**Objectives:**\n- [ ] Final YAML sync to target\n- [ ] Redirect data connectors\n- [ ] Disable source workspace rules\n- [ ] Enable all target workspace rules\n- [ ] Monitor for 24-48 hours\n\n### Phase 5: üèÅ Optimization & Decommission\n**Duration:** 2-4 weeks\n**Objectives:**\n- [ ] Tune analytics rules (reduce false positives)\n- [ ] Update YAML in Git with production learnings\n- [ ] Archive source workspace\n- [ ] Document migration in Git commit history\n\n---\n\n## üéØ Best Practices for YAML-Based Migrations\n\n### 1. **Git Workflow**\n- Use feature branches for rule changes\n- Require pull request reviews before merging\n- Tag releases (v1.0.0, v1.1.0) for major deployments\n- Write meaningful commit messages\n\n### 2. **YAML Management**\n- Keep one rule per YAML file\n- Use descriptive filenames: `BruteForce-SSH-Detection.yaml`\n- Organize by MITRE ATT&CK tactic folders\n- Include comments for complex queries\n\n### 3. **Conversion Strategy**\n- Convert ALL rules to YAML upfront (source of truth)\n- Only convert back to ARM for deployment\n- Never hand-edit ARM JSON (edit YAML instead)\n- Automate conversion in CI/CD pipelines\n\n### 4. **Testing**\n- Use KQL query validation before deployment\n- Test rules in dev/test workspace first\n- Compare alert volumes before/after\n- Document expected baseline alert rates\n\n---\n\n## üìö Essential Resources\n\n### YAML & Conversion Tools\n- **Sentinel-AR-Converter** (Fabian Bader): https://github.com/f-bader/SentinelARConverter\n- **YamlTo-Arm** (SecureHats): https://github.com/SecureHats/yamlto-arm\n- **Sentinel YAML Repo**: https://github.com/Azure/Azure-Sentinel/tree/master/Detections\n\n### Microsoft Documentation\n- [Sentinel Repositories (CI/CD)](https://docs.microsoft.com/azure/sentinel/ci-cd)\n- [Export/import analytics rules](https://docs.microsoft.com/azure/sentinel/import-export-analytics-rules)\n- [Content Hub and solutions](https://docs.microsoft.com/azure/sentinel/sentinel-solutions)\n- [Analytics rules best practices](https://docs.microsoft.com/azure/sentinel/best-practices-analytics)\n\n### Community\n- [Azure Sentinel GitHub](https://github.com/Azure/Azure-Sentinel)\n- [Cloudbrothers Guide](https://cloudbrothers.info/en/convert-sentinel-analytics-rules/)\n- [Sentinel Community Forums](https://techcommunity.microsoft.com/t5/microsoft-sentinel/bd-p/MicrosoftSentinel)\n\n---\n\n## üìù Migration Complexity Matrix\n\n| Component | Complexity | Automation Level | Recommended Method |\n|-----------|------------|------------------|-------------------|\n| Analytics Rules | üü¢ Low | ü§ñ High | **YAML + Sentinel Repositories** ‚≠ê |\n| Workbooks | üü¢ Low | ü§ñ High | ARM export/import |\n| Hunting Queries | üü° Medium | üîß Medium | YAML + Sentinel Repositories |\n| Watchlists | üü¢ Low | ü§ñ High | CSV export/import |\n| Data Connectors | üü° Medium | üîß Medium | Reconfigure, dual setup |\n| Playbooks | üü† High | üîß Medium | ARM export, recreate connections |\n| Automation Rules | üü° Medium | üîß Medium | API export, ARM templates |\n| UEBA Settings | üî¥ Very High | üë§ Manual | Reconfigure, retrain models |\n\n---\n\n## üöÄ Quick Start: YAML Migration Workflow\n\n### 1. Install Tools\n```powershell\nInstall-Module -Name SentinelARConverter\nInstall-Module -Name Az.SecurityInsights\n```\n\n### 2. Export from Source\n```powershell\n# Export all analytics rules\n$rules = Get-AzSentinelAlertRule -WorkspaceName \"source-ws\" -ResourceGroupName \"source-rg\"\n$rules | ConvertTo-Json -Depth 10 | Out-File \"source-rules.json\"\n```\n\n### 3. Convert to YAML\n```powershell\nConvert-SentinelARArmToYaml -Filename \"source-rules.json\" -OutFile \"rules.yaml\"\n```\n\n### 4. Store in Git\n```bash\ngit add rules.yaml\ngit commit -m \"Export Analytics Rules from source workspace\"\ngit push origin main\n```\n\n### 5. Deploy to Target\n- Option A: Push YAML to Sentinel Repositories (auto-deploys)\n- Option B: Convert to ARM and deploy manually\n```powershell\nConvert-SentinelARYamlToArm -Filename \"rules.yaml\" -OutFile \"rules.json\"\naz deployment group create --template-file rules.json --resource-group target-rg\n```\n\n**Done!** Your rules are now managed in YAML and deployed to the target workspace.\n"
            },
            "name": "overview-text"
          },
          {
            "type": 1,
            "content": {
              "json": "## ‚úÖ Comprehensive Migration Checklist\r\n\r\n### üìã Phase 1: Assessment & Discovery\r\n- [ ] **Complete source workspace inventory**\r\n  - Analytics rules count and types\r\n  - Workbooks and dashboards\r\n  - Playbooks and automation rules\r\n  - Data connectors and daily ingestion volumes\r\n  - Watchlists and TI feeds\r\n  - Custom parsers, functions, saved searches\r\n  - UEBA configuration and entity profiles\r\n- [ ] **Document current architecture**\r\n  - Network topology diagram\r\n  - RBAC assignments and AAD groups\r\n  - Integration points (ticketing, SOAR, etc.)\r\n  - Cost analysis (30-day average)\r\n- [ ] **Define success criteria and KPIs**\r\n- [ ] **Identify migration type and approach**\r\n- [ ] **Stakeholder approval obtained**\r\n\r\n### üèóÔ∏è Phase 2: Design & Preparation\r\n- [ ] **Choose Infrastructure-as-Code tool**\r\n  - ARM Templates / Bicep / Terraform selected\r\n  - Git repository created\r\n  - CI/CD pipeline configured\r\n- [ ] **Design target workspace architecture**\r\n  - Retention and archive strategy defined\r\n  - Commitment tier sizing calculated\r\n  - RBAC model designed (least privilege)\r\n  - Network security planned (private endpoints)\r\n- [ ] **Export all configurations via IaC**\r\n  - Analytics rules exported to code\r\n  - Workbooks exported to ARM/Bicep\r\n  - Watchlist data exported (CSV)\r\n  - Playbooks documented/exported\r\n- [ ] **Provision target infrastructure**\r\n  - Workspace deployed via IaC\r\n  - Networking and firewall rules configured\r\n  - Diagnostic logging enabled\r\n  - Retention settings configured\r\n- [ ] **Create detailed migration runbook**\r\n- [ ] **Document rollback plan**\r\n- [ ] **Schedule maintenance windows**\r\n\r\n### üîÑ Phase 3: Parallel Operation\r\n- [ ] **Deploy content to target workspace**\r\n  - Analytics rules deployed and validated\r\n  - Workbooks deployed with updated data sources\r\n  - Hunting queries imported\r\n  - Watchlists imported\r\n- [ ] **Configure dual data ingestion**\r\n  - Multi-workspace connectors enabled (M365, Defender)\r\n  - Additional syslog/CEF forwarders deployed\r\n  - Test data flowing to both workspaces\r\n- [ ] **Recreate automation**\r\n  - Playbooks redeployed to target\r\n  - API connections recreated\r\n  - Managed identities configured\r\n  - Automation rules tested\r\n- [ ] **Validate functionality**\r\n  - Compare alert volumes (>95% parity)\r\n  - Test incident creation and assignment\r\n  - Verify all integrations working\r\n  - Load testing completed\r\n- [ ] **Train SOC team**\r\n  - New workspace navigation training\r\n  - Updated runbooks distributed\r\n  - Practice incident response scenarios\r\n  - Rollback procedures reviewed\r\n\r\n### ‚úÖ Phase 4: Migration & Cutover\r\n- [ ] **Pre-cutover validation**\r\n  - Final smoke tests passed\r\n  - Rollback plan rehearsed\r\n  - Communication sent to stakeholders\r\n  - Change approval obtained\r\n- [ ] **Execute cutover**\r\n  - Single-destination connectors redirected\r\n  - DNS and firewall rules updated\r\n  - Agent-based collection switched\r\n  - Integration endpoints updated\r\n- [ ] **Verify cutover success**\r\n  - Data ingestion confirmed in target\r\n  - Connector health validated\r\n  - Alerts generating correctly\r\n  - Playbooks executing successfully\r\n- [ ] **Handle historical data** (if applicable)\r\n  - Critical incidents exported to CSV\r\n  - Source workspace archived\r\n  - Cross-workspace queries configured\r\n- [ ] **Monitor for 24-48 hours**\r\n  - Ingestion latency monitored (<5 min)\r\n  - Alert volume tracked\r\n  - SOC team monitored for issues\r\n  - No rollback triggers hit\r\n\r\n### üèÅ Phase 5: Optimization & Decommission\r\n- [ ] **Optimize target workspace**\r\n  - Analytic rules tuned (false positive reduction)\r\n  - Query performance optimized\r\n  - Retention and archive reviewed\r\n  - Cost optimization applied\r\n- [ ] **Validate migration success**\r\n  - All components migrated\r\n  - No detection capability degradation\r\n  - SOC metrics maintained/improved\r\n  - Cost expectations met\r\n- [ ] **Decommission source workspace**\r\n  - Final incident history exported\r\n  - Configurations archived\r\n  - Data connectors disabled\r\n  - Workspace scheduled for deletion (after retention)\r\n- [ ] **Complete documentation**\r\n  - Migration report created\r\n  - Lessons learned documented\r\n  - Updated architecture diagrams\r\n  - Knowledge base articles updated\r\n- [ ] **Post-migration review**\r\n  - Stakeholder feedback collected\r\n  - Success metrics reported\r\n  - Process improvements identified\r\n\r\n---\r\n\r\n### üéØ Quick Wins Checklist (First 30 Days Post-Migration)\r\n- [ ] Enable commitment tier pricing (if 100GB+ daily)\r\n- [ ] Configure archive for data 91-365 days old\r\n- [ ] Review and disable noisy/low-value analytics rules\r\n- [ ] Set up workspace health monitoring\r\n- [ ] Configure Basic Logs for high-volume, low-value data\r\n- [ ] Implement query performance monitoring\r\n- [ ] Schedule monthly cost review\r\n- [ ] Set up automated testing for critical rules\r\n",
              "style": "info"
            },
            "name": "checklist"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Overview"
      },
      "name": "MigrationOverview"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Migration Readiness Assessment",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# üéØ Migration Readiness Assessment\n\nComprehensive inventory and status tracking for your Sentinel-to-Sentinel migration.\n\n---"
            },
            "name": "readiness-main-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{SourceWorkspace}/providers/Microsoft.SecurityInsights/alertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2023-02-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[]}}]}\n| summarize SourceAnalyticsRules = count()\n| extend Component = 'Analytics Rules'",
              "size": 4,
              "queryType": 12,
              "visualization": "table"
            },
            "conditionalVisibility": {
              "parameterName": "HiddenQueries",
              "comparison": "isEqualTo",
              "value": "show"
            },
            "name": "hidden-source-analytics-count"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{Workspace:resourcegroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/alertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-10-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[]}}]}\n| summarize TargetAnalyticsRules = count()\n| extend Component = 'Analytics Rules'",
              "size": 4,
              "queryType": 12,
              "visualization": "table"
            },
            "conditionalVisibility": {
              "parameterName": "HiddenQueries",
              "comparison": "isEqualTo",
              "value": "show"
            },
            "name": "hidden-target-analytics-count"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type in ('microsoft.insights/datacollectionrules', 'microsoft.insights/workbooks')\n| extend SourceRG = tostring(split('{SourceWorkspace}', '/')[4])\n| extend TargetRG = tostring(split('{Workspace}', '/')[4])\n| extend RG = tolower(resourceGroup)\n| extend Component = case(\n    type =~ 'microsoft.insights/datacollectionrules', 'DCRs',\n    type =~ 'microsoft.insights/workbooks', 'Workbooks',\n    'Other'\n)\n| extend WSType = case(\n    RG == tolower(SourceRG), 'Source',\n    RG == tolower(TargetRG), 'Target',\n    'Other'\n)\n| where WSType in ('Source', 'Target')\n| summarize Count = count() by Component, WSType\n| summarize SourceCount = sumif(Count, WSType == 'Source'), TargetCount = sumif(Count, WSType == 'Target') by Component",
              "size": 4,
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "visualization": "table"
            },
            "conditionalVisibility": {
              "parameterName": "HiddenQueries",
              "comparison": "isEqualTo",
              "value": "show"
            },
            "name": "hidden-resource-graph-counts"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"analytics-source\",\"type\":\"query\",\"request\":{\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"data\\\":null,\\\"headers\\\":[],\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"{SourceWorkspace}/providers/Microsoft.SecurityInsights/alertRules\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2023-02-01\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[]}}]}\\n| summarize SourceCount = count()\\n| extend Component = 'Analytics Rules'\",\"queryType\":12}},{\"id\":\"analytics-target\",\"type\":\"query\",\"request\":{\"query\":\"{\\\"version\\\":\\\"ARMEndpoint/1.0\\\",\\\"data\\\":null,\\\"headers\\\":[],\\\"method\\\":\\\"GET\\\",\\\"path\\\":\\\"/subscriptions/{Subscription:id}/resourceGroups/{Workspace:resourcegroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/alertRules\\\",\\\"urlParams\\\":[{\\\"key\\\":\\\"api-version\\\",\\\"value\\\":\\\"2021-10-01-preview\\\"}],\\\"batchDisabled\\\":false,\\\"transformers\\\":[{\\\"type\\\":\\\"jsonpath\\\",\\\"settings\\\":{\\\"tablePath\\\":\\\"$.value\\\",\\\"columns\\\":[]}}]}\\n| summarize TargetCount = count()\\n| extend Component = 'Analytics Rules'\",\"queryType\":12}},{\"id\":\"resource-graph\",\"type\":\"query\",\"request\":{\"query\":\"resources\\n| where type in ('microsoft.insights/datacollectionrules', 'microsoft.insights/workbooks')\\n| extend SourceRG = tostring(split('{SourceWorkspace}', '/')[4])\\n| extend TargetRG = tostring(split('{Workspace}', '/')[4])\\n| extend RG = tolower(resourceGroup)\\n| extend Component = case(\\n    type =~ 'microsoft.insights/datacollectionrules', 'DCRs',\\n    type =~ 'microsoft.insights/workbooks', 'Workbooks',\\n    'Other'\\n)\\n| extend WSType = case(\\n    RG == tolower(SourceRG), 'Source',\\n    RG == tolower(TargetRG), 'Target',\\n    'Other'\\n)\\n| where WSType in ('Source', 'Target')\\n| summarize Count = count() by Component, WSType\\n| summarize SourceCount = sumif(Count, WSType == 'Source'), TargetCount = sumif(Count, WSType == 'Target') by Component\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"]}}],\"outputs\":[{\"query\":\"analytics-source\\n| extend Component = 'Analytics Rules'\\n| union (analytics-target | extend Component = 'Analytics Rules')\\n| union (resource-graph)\\n| summarize SourceCount = max(SourceCount), TargetCount = max(TargetCount) by Component\\n| extend HasData = iff(SourceCount > 0 or TargetCount > 0, 1, 0)\\n| extend Migrated = iff(TargetCount >= SourceCount and SourceCount > 0, 1, 0)\\n| summarize\\n    TotalComponents = countif(HasData == 1),\\n    MigratedComponents = sum(Migrated)\\n| extend ReadinessPercent = iff(TotalComponents > 0, round(100.0 * MigratedComponents / TotalComponents, 0), 0.0)\\n| extend Status = case(\\n    ReadinessPercent >= 90, '‚úÖ Ready for Cutover',\\n    ReadinessPercent >= 70, 'üü° Nearly Complete',\\n    ReadinessPercent >= 40, 'üü† In Progress',\\n    ReadinessPercent > 0, 'üî¥ Early Stage',\\n    '‚ö™ Not Started'\\n)\\n| project ReadinessPercent, Status, ComponentsComplete = strcat(MigratedComponents, ' of ', TotalComponents)\"}]}",
              "size": 4,
              "title": "Overall Migration Readiness",
              "queryType": 7,
              "visualization": "tiles",
              "tileSettings": {
                "titleContent": {
                  "columnMatch": "Status",
                  "formatter": 1
                },
                "leftContent": {
                  "columnMatch": "ReadinessPercent",
                  "formatter": 12,
                  "formatOptions": {
                    "palette": "auto"
                  },
                  "numberFormat": {
                    "unit": 1,
                    "options": {
                      "style": "decimal"
                    }
                  }
                },
                "secondaryContent": {
                  "columnMatch": "ComponentsComplete",
                  "formatter": 1
                },
                "showBorder": true
              }
            },
            "conditionalVisibility": {
              "parameterName": "SourceWorkspace",
              "comparison": "isNotEqualTo"
            },
            "name": "overall-readiness-tile"
          },
          {
            "type": 1,
            "content": {
              "json": "## üìã Component Migration Inventory\n\nAutomated tracking for key Sentinel migration components.\n\n> **‚úÖ Automated Tracking:**\n> - **Analytics Rules** (via ARM API)\n> - **DCRs** (Data Collection Rules via Resource Graph)\n> - **Workbooks** (via Resource Graph)\n>\n> **‚ö†Ô∏è Manual Tracking Required:**\n> - **Watchlists**: Sentinel ‚Üí Watchlists  \n> - **Automation Rules**: Sentinel ‚Üí Automation\n> - **Playbooks**: Logic Apps in resource group\n> - **Hunting Queries**: Sentinel ‚Üí Hunting"
            },
            "name": "component-inventory-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Component Migration Status - DCRs and Workbooks only\n// Analytics Rules shown separately below\nresources\n| where type in ('microsoft.insights/datacollectionrules', 'microsoft.insights/workbooks')\n| extend SourceRG = tostring(split('{SourceWorkspace}', '/')[4])\n| extend TargetRG = tostring(split('{Workspace}', '/')[4])\n| extend RG = tolower(resourceGroup)\n| extend Component = case(\n    type =~ 'microsoft.insights/datacollectionrules', 'DCRs',\n    type =~ 'microsoft.insights/workbooks', 'Workbooks',\n    'Other'\n)\n| extend WSType = case(\n    RG == tolower(SourceRG), 'Source',\n    RG == tolower(TargetRG), 'Target',\n    'Other'\n)\n| where WSType in ('Source', 'Target')\n| summarize Count = count() by Component, WSType\n| summarize SourceCount = sumif(Count, WSType == 'Source'), TargetCount = sumif(Count, WSType == 'Target') by Component\n| extend PercentComplete = case(\n    SourceCount == 0 and TargetCount == 0, real(null),\n    SourceCount > 0, round(100.0 * TargetCount / SourceCount, 1),\n    0.0\n)\n| extend Gap = case(\n    SourceCount == 0 and TargetCount == 0, long(null),\n    SourceCount - TargetCount\n)\n| extend Status = case(\n    SourceCount == 0 and TargetCount == 0, '‚ö™ Not Applicable',\n    TargetCount >= SourceCount, '‚úÖ Complete',\n    TargetCount > 0, 'üü° In Progress',\n    'üî¥ Not Started'\n)\n| order by PercentComplete asc, Gap desc",
              "size": 0,
              "title": "Component Migration Status - Infrastructure",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "SourceCount",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "TargetCount",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green"
                    }
                  },
                  {
                    "columnMatch": "PercentComplete",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1,
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "Gap",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Complete",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Progress",
                          "representation": "2",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Not Started",
                          "representation": "4",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "Blank",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "Component",
                    "label": "Component Type"
                  },
                  {
                    "columnId": "SourceCount",
                    "label": "Source Count"
                  },
                  {
                    "columnId": "TargetCount",
                    "label": "Target Count"
                  },
                  {
                    "columnId": "PercentComplete",
                    "label": "% Complete"
                  },
                  {
                    "columnId": "Gap",
                    "label": "Items Remaining"
                  },
                  {
                    "columnId": "Status",
                    "label": "Migration Status"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "SourceWorkspace",
              "comparison": "isNotEqualTo"
            },
            "name": "comprehensive-inventory-table"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"{SourceWorkspace}/providers/Microsoft.SecurityInsights/alertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2023-02-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.name\",\"columnid\":\"RuleName\"}]}}]}\n| summarize SourceCount = count()\n| extend Component = 'Analytics Rules'",
              "size": 4,
              "queryType": 12,
              "visualization": "table"
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "HiddenForMerge",
              "comparison": "isEqualTo",
              "value": "show"
            },
            "name": "hidden-source-analytics"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{Subscription:id}/resourceGroups/{Workspace:resourcegroup}/providers/Microsoft.OperationalInsights/workspaces/{Workspace:name}/providers/Microsoft.SecurityInsights/alertRules\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-10-01-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value\",\"columns\":[{\"path\":\"$.name\",\"columnid\":\"RuleName\"}]}}]}\n| summarize TargetCount = count()\n| extend Component = 'Analytics Rules'",
              "size": 4,
              "queryType": 12,
              "visualization": "table"
            },
            "customWidth": "50",
            "conditionalVisibility": {
              "parameterName": "HiddenForMerge",
              "comparison": "isEqualTo",
              "value": "show"
            },
            "name": "hidden-target-analytics"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"source\",\"mergeType\":\"table\",\"leftColumn\":\"Component\"},{\"id\":\"target\",\"mergeType\":\"table\",\"leftColumn\":\"Component\"}],\"projectRename\":[{\"originalName\":\"[source].Component\"},{\"originalName\":\"[source].SourceCount\"},{\"originalName\":\"[target].TargetCount\"}],\"tables\":[{\"tableName\":\"hidden-source-analytics\",\"id\":\"source\"},{\"tableName\":\"hidden-target-analytics\",\"id\":\"target\"}]}\n| extend PercentComplete = case(\n    SourceCount == 0 and TargetCount == 0, real(null),\n    SourceCount > 0, round(100.0 * TargetCount / SourceCount, 1),\n    0.0\n)\n| extend Gap = case(\n    SourceCount == 0 and TargetCount == 0, long(null),\n    SourceCount - TargetCount\n)\n| extend Status = case(\n    SourceCount == 0 and TargetCount == 0, '‚ö™ Not Applicable',\n    TargetCount >= SourceCount, '‚úÖ Complete',\n    TargetCount > 0, 'üü° In Progress',\n    'üî¥ Not Started'\n)\n| project Component, SourceCount, TargetCount, PercentComplete, Gap, Status",
              "size": 0,
              "title": "Analytics Rules Migration Status",
              "queryType": 7,
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "SourceCount",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "blue"
                    }
                  },
                  {
                    "columnMatch": "TargetCount",
                    "formatter": 8,
                    "formatOptions": {
                      "palette": "green"
                    }
                  },
                  {
                    "columnMatch": "PercentComplete",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "greenRed"
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1,
                        "maximumFractionDigits": 1
                      }
                    }
                  },
                  {
                    "columnMatch": "Gap",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "greenRed"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Complete",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Progress",
                          "representation": "2",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Not Started",
                          "representation": "4",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "Blank",
                          "text": "{0}"
                        }
                      ]
                    }
                  }
                ],
                "labelSettings": [
                  {
                    "columnId": "Component",
                    "label": "Component Type"
                  },
                  {
                    "columnId": "SourceCount",
                    "label": "Source Count"
                  },
                  {
                    "columnId": "TargetCount",
                    "label": "Target Count"
                  },
                  {
                    "columnId": "PercentComplete",
                    "label": "% Complete"
                  },
                  {
                    "columnId": "Gap",
                    "label": "Items Remaining"
                  },
                  {
                    "columnId": "Status",
                    "label": "Migration Status"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "SourceWorkspace",
              "comparison": "isNotEqualTo"
            },
            "name": "analytics-rules-migration-status"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## üîå Data Connector Migration Matrix\n\nDetailed view of data ingestion by connector type:"
            },
            "name": "connector-matrix-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "// Data Connector Migration Matrix\nlet ConnectorMapping = datatable(TableName: string, ConnectorName: string, ConnectorType: string)\n[\n    'SigninLogs', 'Azure Active Directory - Sign-ins', 'Microsoft',\n    'AuditLogs', 'Azure Active Directory - Audit', 'Microsoft',\n    'AADNonInteractiveUserSignInLogs', 'Azure AD - Non-Interactive Sign-ins', 'Microsoft',\n    'SecurityEvent', 'Windows Security Events (Agent/AMA)', 'Agent',\n    'Syslog', 'Linux Syslog (Agent/AMA)', 'Agent',\n    'CommonSecurityLog', 'CEF via Syslog', 'Syslog',\n    'AzureActivity', 'Azure Activity Logs', 'Microsoft',\n    'AzureDiagnostics', 'Azure Resource Diagnostics', 'Microsoft',\n    'OfficeActivity', 'Office 365', 'Microsoft',\n    'SecurityAlert', 'Microsoft Defender Alerts', 'Microsoft',\n    'SecurityIncident', 'Microsoft Sentinel Incidents', 'Microsoft',\n    'ThreatIntelligenceIndicator', 'Threat Intelligence', 'Microsoft',\n    'AWSCloudTrail', 'AWS CloudTrail', 'Third-Party',\n    'GWorkspaceActivityReports', 'Google Workspace', 'Third-Party',\n    'ASimDnsActivityLogs', 'DNS Activity (ASIM)', 'ASIM'\n];\n\nlet SourceTables = workspace('{SourceWorkspace}').Usage\n| where TimeGenerated > ago(30d)\n| where IsBillable == true\n| summarize SourceGB = round(sum(Quantity), 2), SourceDays = dcount(bin(TimeGenerated, 1d)) by DataType;\n\nlet TargetTables = workspace('{Workspace}').Usage\n| where TimeGenerated > ago(30d)\n| where IsBillable == true\n| summarize TargetGB = round(sum(Quantity), 2), TargetDays = dcount(bin(TimeGenerated, 1d)) by DataType;\n\nConnectorMapping\n| join kind=leftouter (SourceTables) on $left.TableName == $right.DataType\n| join kind=leftouter (TargetTables) on $left.TableName == $right.DataType\n| extend SourceGB = coalesce(SourceGB, 0.0)\n| extend TargetGB = coalesce(TargetGB, 0.0)\n| extend Status = case(\n    SourceGB == 0 and TargetGB == 0, '‚ö™ Not Used',\n    TargetGB >= SourceGB * 0.8, '‚úÖ Migrated',\n    TargetGB > 0, 'üü° Partial Migration',\n    'üî¥ Pending'\n)\n| extend DataLoss = iff(SourceGB > 0 and TargetGB < SourceGB, \n                        round((SourceGB - TargetGB) / SourceGB * 100, 1), 0.0)\n| project ConnectorName, ConnectorType, SourceGB, TargetGB, Status, DataLoss\n| order by SourceGB desc",
              "size": 0,
              "title": "Data Connector Status (Last 30 Days)",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{SourceWorkspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "SourceGB",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue"
                    },
                    "numberFormat": {
                      "unit": 5,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 2,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "TargetGB",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "green"
                    },
                    "numberFormat": {
                      "unit": 5,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 2,
                        "maximumFractionDigits": 2
                      }
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Migrated",
                          "representation": "success",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Partial",
                          "representation": "2",
                          "text": "{0}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Pending",
                          "representation": "4",
                          "text": "{0}"
                        },
                        {
                          "operator": "Default",
                          "representation": "Blank",
                          "text": "{0}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "DataLoss",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 100,
                      "palette": "redGreen"
                    },
                    "numberFormat": {
                      "unit": 1,
                      "options": {
                        "style": "decimal",
                        "minimumFractionDigits": 1,
                        "maximumFractionDigits": 1
                      }
                    }
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "ConnectorName",
                    "label": "Connector"
                  },
                  {
                    "columnId": "ConnectorType",
                    "label": "Type"
                  },
                  {
                    "columnId": "SourceGB",
                    "label": "Source (GB)"
                  },
                  {
                    "columnId": "TargetGB",
                    "label": "Target (GB)"
                  },
                  {
                    "columnId": "Status",
                    "label": "Migration Status"
                  },
                  {
                    "columnId": "DataLoss",
                    "label": "Data Loss %"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "SourceWorkspace",
              "comparison": "isNotEqualTo"
            },
            "customWidth": "100",
            "name": "data-connector-matrix"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## üìä Analytics Rules Status\n\nComparison of detection rules between workspaces:\n\n> **Note**: Analytics Rules data is fetched via ARM API. The detailed breakdown is shown in the Analytics Rules tab."
            },
            "name": "analytics-rules-header"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## ‚öôÔ∏è DCR (Data Collection Rules) Status\n\nAgent-based data collection configuration:"
            },
            "name": "dcr-status-header"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "resources\n| where type == \"microsoft.insights/datacollectionrules\"\n| extend WorkspaceId = tostring(properties.destinations.logAnalytics[0].workspaceResourceId)\n| extend SourceWorkspaceId = tolower('{SourceWorkspace}')\n| extend TargetWorkspaceId = tolower('{Workspace}')\n| extend IsSource = tolower(WorkspaceId) has SourceWorkspaceId\n| extend IsTarget = tolower(WorkspaceId) has TargetWorkspaceId\n| extend Location = location\n| extend DataSources = bag_keys(properties.dataSources)\n| summarize \n    DCRCount = count(),\n    Locations = make_set(Location),\n    DataSourceTypes = make_set(DataSources)\n  by Workspace = case(\n    IsSource, 'Source',\n    IsTarget, 'Target',\n    'Other'\n  )\n| where Workspace in ('Source', 'Target')\n| project Workspace, DCRCount, Locations, DataSourceTypes",
              "size": 0,
              "title": "DCR Distribution by Workspace",
              "queryType": 1,
              "resourceType": "microsoft.resourcegraph/resources",
              "crossComponentResources": [
                "{Subscription}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "DCRCount",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "palette": "blue"
                    }
                  }
                ],
                "filter": true,
                "labelSettings": [
                  {
                    "columnId": "Workspace",
                    "label": "Workspace"
                  },
                  {
                    "columnId": "DCRCount",
                    "label": "DCR Count"
                  },
                  {
                    "columnId": "Locations",
                    "label": "Azure Regions"
                  },
                  {
                    "columnId": "DataSourceTypes",
                    "label": "Data Source Types"
                  }
                ]
              }
            },
            "conditionalVisibility": {
              "parameterName": "SourceWorkspace",
              "comparison": "isNotEqualTo"
            },
            "name": "dcr-status-query"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## üìù Missing Components (Gap Analysis)\n\nItems that exist in **source** but are **missing in target**:\n\n> **Note**: This section will show specific component names once ARM API queries are integrated. For now, use the individual tabs (Analytics Rules, Watchlists, etc.) to see detailed gaps."
            },
            "name": "gap-analysis-header"
          },
          {
            "type": 1,
            "content": {
              "json": "---\n\n## üí° Migration Tips & Recommendations\n\nBased on the readiness assessment above:\n\n### Quick Actions\n- Review the **Component Migration Status** table for overall progress\n- Check the **Data Connector Matrix** for detailed connector-level status\n- Visit individual tabs (Analytics Rules, Watchlists, etc.) for component-specific migration actions\n- Use the **Gap Analysis** section to identify what still needs to be migrated\n\n### Recommended Migration Sequence\n1. **Data Connectors First** - Ensure all critical data connectors are migrated (look for üî¥ Pending status)\n2. **Analytics Rules** - Review and deploy detection rules in the Analytics Rules tab\n3. **Watchlists** - Migrate reference data used by analytics rules\n4. **Playbooks & Automation Rules** - Migrate incident response automation\n5. **DCRs** - Verify Data Collection Rules are pointing to the target workspace\n6. **Workbooks & Hunting Queries** - Migrate dashboards and saved queries\n\n### Pre-Cutover Checklist\n- [ ] All critical data connectors are ingesting (check for ‚úÖ Complete status)\n- [ ] Analytics rules are deployed and enabled in target\n- [ ] Playbooks are updated with target workspace references\n- [ ] Test incident creation and response workflow end-to-end\n- [ ] Verify UEBA and entity behavior analytics configuration\n- [ ] Document any custom configurations or integrations\n\n### Common Migration Pitfalls\n\n‚ö†Ô∏è **Data Loss Risk**: Connectors showing üü° Partial status may have data loss. Review the Data Loss % column.\n\n‚ö†Ô∏è **Playbook Managed Identities**: Remember to update managed identity permissions in target workspace.\n\n‚ö†Ô∏è **DCR Associations**: Virtual machines need to be reassociated with new DCRs.\n\n‚ö†Ô∏è **Watchlist Dependencies**: Migrate watchlists before analytics rules that reference them.\n\n### Need Help?\nRefer to individual component tabs for detailed migration instructions and export/import capabilities.",
              "style": "info"
            },
            "conditionalVisibility": {
              "parameterName": "MigrationTips",
              "comparison": "isEqualTo",
              "value": "Yes"
            },
            "name": "progress-summary-with-tips"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "Tab",
        "comparison": "isEqualTo",
        "value": "Readiness"
      },
      "name": "ReadinessAssessment"
    }
  ],
  "fallbackResourceIds": [
    "Azure Monitor"
  ],
  "fromTemplateId": "MicrosoftSentinelDeploymentandMigrationTracker",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}